var define,__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();function JL(loggerName){if(!loggerName)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(callback,initialValue){for(var previousValue=initialValue,i=0;i<this.length;i++)previousValue=callback(previousValue,this[i],i,this);return previousValue});var accumulatedLoggerName="";return("."+loggerName).split(".").reduce(function(prev,curr,idx,arr){accumulatedLoggerName?accumulatedLoggerName+="."+curr:accumulatedLoggerName=curr;curr=prev["__"+accumulatedLoggerName];return void 0===curr&&(JL.Logger.prototype=prev,curr=new JL.Logger(accumulatedLoggerName),prev["__"+accumulatedLoggerName]=curr),curr},JL.__)}!function(JL){function copyProperty(propertyName,from,to){void 0!==from[propertyName]&&(null===from[propertyName]?delete to[propertyName]:to[propertyName]=from[propertyName])}function allow(filters){if(null==JL.enabled||JL.enabled){try{if(filters.userAgentRegex&&!new RegExp(filters.userAgentRegex).test(navigator.userAgent))return}catch(e){}try{if(filters.ipRegex&&JL.clientIP&&!new RegExp(filters.ipRegex).test(JL.clientIP))return}catch(e){}return 1}}function allowMessage(filters,message){try{if(filters.disallow&&new RegExp(filters.disallow).test(message))return}catch(e){}return 1}function stringifyLogObjectFunction(logObject){return"function"==typeof logObject?logObject instanceof RegExp?logObject.toString():logObject():logObject}JL.requestId="",JL.entryId=0,JL._createXMLHttpRequest=function(){return new XMLHttpRequest},JL._getTime=function(){return(new Date).getTime()},JL._console=console,JL._appenderNames=[];var StringifiedLogObject=function(msg,meta,finalString){this.msg=msg,this.meta=meta,this.finalString=finalString};function stringifyLogObject(logObject){var finalString,actualLogObject=stringifyLogObjectFunction(logObject);switch(typeof actualLogObject){case"string":return new StringifiedLogObject(actualLogObject,null,actualLogObject);case"number":case"boolean":return finalString=actualLogObject.toString(),new StringifiedLogObject(finalString,null,finalString);case"undefined":return new StringifiedLogObject("undefined",null,"undefined");case"object":return actualLogObject instanceof RegExp||actualLogObject instanceof String||actualLogObject instanceof Number||actualLogObject instanceof Boolean?(finalString=actualLogObject.toString(),new StringifiedLogObject(finalString,null,finalString)):(finalString="function"==typeof JL.serialize?JL.serialize.call(this,actualLogObject):JSON.stringify(actualLogObject),new StringifiedLogObject("",actualLogObject,finalString));default:return new StringifiedLogObject("unknown",null,"unknown")}}function getTraceLevel(){return 1e3}function getDebugLevel(){return 2e3}function getInfoLevel(){return 3e3}function getWarnLevel(){return 4e3}function getErrorLevel(){return 5e3}function getFatalLevel(){return 6e3}JL.setOptions=function(options){return copyProperty("enabled",options,this),copyProperty("maxMessages",options,this),copyProperty("defaultAjaxUrl",options,this),copyProperty("clientIP",options,this),copyProperty("requestId",options,this),copyProperty("defaultBeforeSend",options,this),copyProperty("serialize",options,this),this},JL.getAllLevel=function(){return-2147483648},JL.getTraceLevel=getTraceLevel,JL.getDebugLevel=getDebugLevel,JL.getInfoLevel=getInfoLevel,JL.getWarnLevel=getWarnLevel,JL.getErrorLevel=getErrorLevel,JL.getFatalLevel=getFatalLevel,JL.getOffLevel=function(){return 2147483647};var Exception=function(data,inner){this.inner=inner,this.name="JL.Exception",this.message=stringifyLogObject(data).finalString},LogItem=((JL.Exception=Exception).prototype=new Error,function(l,m,n,t,u){this.l=l,this.m=m,this.n=n,this.t=t,this.u=u});function newLogItem(levelNbr,message,loggerName){return JL.entryId++,new LogItem(levelNbr,message,loggerName,JL._getTime(),JL.entryId)}function clearTimer(timer){timer.id&&(clearTimeout(timer.id),timer.id=null)}function setTimer(timer,timeoutMs,callback){var that=this;timer.id||(timer.id=setTimeout(function(){callback.call(that)},timeoutMs))}JL.LogItem=LogItem;var Exception=function(){function Appender(appenderName,sendLogItems){this.appenderName=appenderName,this.sendLogItems=sendLogItems,this.level=JL.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;sendLogItems="Trying to create an appender without a name or with an empty name";if(null==appenderName)throw sendLogItems;if(-1!=JL._appenderNames.indexOf(appenderName)){if(appenderName)throw"Multiple appenders use the same name "+appenderName;throw sendLogItems}JL._appenderNames.push(appenderName)}return Appender.prototype.addLogItemsToBuffer=function(logItems){if(this.batchBuffer.length>=this.maxBatchSize)this.nbrLogItemsSkipped+=logItems.length;else{if(null!=JL.maxMessages){if(JL.maxMessages<1)return;JL.maxMessages-=logItems.length}this.batchBuffer=this.batchBuffer.concat(logItems);var that=this;setTimer(this.batchTimeoutTimer,this.batchTimeout,function(){that.sendBatch.call(that)})}},Appender.prototype.batchBufferHasOverdueMessages=function(){for(var i=0;i<this.batchBuffer.length;i++)if(JL._getTime()-this.batchBuffer[i].t>this.batchTimeout)return!0;return!1},Appender.prototype.batchBufferHasStrandedMessage=function(){return!(null==JL.maxMessages)&&JL.maxMessages<1&&0<this.batchBuffer.length},Appender.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},Appender.prototype.onSendingEnded=function(){clearTimer(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},Appender.prototype.setOptions=function(options){if(copyProperty("level",options,this),copyProperty("ipRegex",options,this),copyProperty("userAgentRegex",options,this),copyProperty("disallow",options,this),copyProperty("sendWithBufferLevel",options,this),copyProperty("storeInBufferLevel",options,this),copyProperty("bufferSize",options,this),copyProperty("batchSize",options,this),copyProperty("maxBatchSize",options,this),copyProperty("batchTimeout",options,this),copyProperty("sendTimeout",options,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new JL.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},Appender.prototype.log=function(level,msg,meta,callback,levelNbr,message,loggerName){!allow(this)||!allowMessage(this,message)||levelNbr<this.storeInBufferLevel||(message=newLogItem(levelNbr,message,loggerName),levelNbr<this.level?0<this.bufferSize&&(this.buffer.push(message),this.buffer.length>this.bufferSize)&&this.buffer.shift():(this.addLogItemsToBuffer([message]),levelNbr>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()))},Appender.prototype.sendBatch=function(){var that;0<this.nbrLogItemsBeingSent||(clearTimer(this.batchTimeoutTimer),0!=this.batchBuffer.length&&(this.nbrLogItemsBeingSent=this.batchBuffer.length,setTimer((that=this).sendTimeoutTimer,this.sendTimeout,function(){that.onSendingEnded.call(that)}),this.sendLogItems(this.batchBuffer,function(){that.batchBuffer.splice(0,that.nbrLogItemsBeingSent),0<that.nbrLogItemsSkipped&&(that.batchBuffer.push(newLogItem(4e3,"Lost "+that.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",that.appenderName)),that.nbrLogItemsSkipped=0),that.onSendingEnded.call(that)})))},Appender}(),AjaxAppender=function(_super){function AjaxAppender(appenderName){return _super.call(this,appenderName,AjaxAppender.prototype.sendLogItemsAjax)||this}return __extends(AjaxAppender,_super),AjaxAppender.prototype.setOptions=function(options){return copyProperty("url",options,this),copyProperty("beforeSend",options,this),_super.prototype.setOptions.call(this,options),this},AjaxAppender.prototype.sendLogItemsAjax=function(logItems,successCallback){try{var ajaxUrl,that,json,finalmsg;allow(this)&&(this.xhr&&0!=this.xhr.readyState&&4!=this.xhr.readyState&&this.xhr.abort(),this.xhr=JL._createXMLHttpRequest(),ajaxUrl="/helper/jsnlog/jsnlog.logger.php",null!=JL.defaultAjaxUrl&&(ajaxUrl=JL.defaultAjaxUrl),this.url&&(ajaxUrl=this.url),this.xhr.open("POST",ajaxUrl),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",JL.requestId),(that=this).xhr.onreadystatechange=function(){4==that.xhr.readyState&&200<=that.xhr.status&&that.xhr.status<300&&successCallback()},json={r:JL.requestId,lg:logItems},"function"==typeof this.beforeSend?this.beforeSend.call(this,this.xhr,json):"function"==typeof JL.defaultBeforeSend&&JL.defaultBeforeSend.call(this,this.xhr,json),finalmsg=JSON.stringify(json),this.xhr.send(finalmsg))}catch(e){}},AjaxAppender}(JL.Appender=Exception),ConsoleAppender=(JL.AjaxAppender=AjaxAppender,function(_super){function ConsoleAppender(appenderName){return _super.call(this,appenderName,ConsoleAppender.prototype.sendLogItemsConsole)||this}return __extends(ConsoleAppender,_super),ConsoleAppender.prototype.clog=function(logEntry){JL._console.log(logEntry)},ConsoleAppender.prototype.cerror=function(logEntry){JL._console.error?JL._console.error(logEntry):this.clog(logEntry)},ConsoleAppender.prototype.cwarn=function(logEntry){JL._console.warn?JL._console.warn(logEntry):this.clog(logEntry)},ConsoleAppender.prototype.cinfo=function(logEntry){JL._console.info?JL._console.info(logEntry):this.clog(logEntry)},ConsoleAppender.prototype.cdebug=function(logEntry){JL._console.debug?JL._console.debug(logEntry):this.cinfo(logEntry)},ConsoleAppender.prototype.sendLogItemsConsole=function(logItems,successCallback){try{if(!allow(this))return;if(!JL._console)return;for(var i=0;i<logItems.length;++i){var li=logItems[i],msg=li.n+": "+li.m;"undefined"==typeof window&&(msg=new Date(li.t)+" | "+msg),li.l<=JL.getDebugLevel()?this.cdebug(msg):li.l<=JL.getInfoLevel()?this.cinfo(msg):li.l<=JL.getWarnLevel()?this.cwarn(msg):this.cerror(msg)}}catch(e){}successCallback()},ConsoleAppender}(Exception)),Exception=(JL.ConsoleAppender=ConsoleAppender,function(){function Logger(loggerName){this.loggerName=loggerName,this.seenRegexes=[]}return Logger.prototype.setOptions=function(options){return copyProperty("level",options,this),copyProperty("userAgentRegex",options,this),copyProperty("disallow",options,this),copyProperty("ipRegex",options,this),copyProperty("appenders",options,this),copyProperty("onceOnly",options,this),this.seenRegexes=[],this},Logger.prototype.buildExceptionObject=function(e){var excObject={};return e.message&&(excObject.message=e.message),e.name&&(excObject.name=e.name),e.data&&(excObject.data=e.data),e.inner&&(excObject.inner=this.buildExceptionObject(e.inner)),excObject},Logger.prototype.log=function(level,logObject,e){var compositeMessage,excObject,i=0;if(this.appenders&&level>=this.level&&allow(this)&&(e?(excObject=this.buildExceptionObject(e)).logData=stringifyLogObjectFunction(logObject):excObject=logObject,allowMessage(this,(compositeMessage=stringifyLogObject(excObject)).finalString))){if(this.onceOnly)for(i=this.onceOnly.length-1;0<=i;){if(new RegExp(this.onceOnly[i]).test(compositeMessage.finalString)){if(this.seenRegexes[i])return this;this.seenRegexes[i]=!0}i--}for(compositeMessage.meta=compositeMessage.meta||{},i=this.appenders.length-1;0<=i;)this.appenders[i].log(function(level){return level<=1e3?"trace":level<=2e3?"debug":level<=3e3?"info":level<=4e3?"warn":level<=5e3?"error":"fatal"}(level),compositeMessage.msg,compositeMessage.meta,function(){},level,compositeMessage.finalString,this.loggerName),i--}return this},Logger.prototype.trace=function(logObject){return this.log(1e3,logObject)},Logger.prototype.debug=function(logObject){return this.log(2e3,logObject)},Logger.prototype.info=function(logObject){return this.log(3e3,logObject)},Logger.prototype.warn=function(logObject){return this.log(4e3,logObject)},Logger.prototype.error=function(logObject){return this.log(5e3,logObject)},Logger.prototype.fatal=function(logObject){return this.log(6e3,logObject)},Logger.prototype.fatalException=function(logObject,e){return this.log(6e3,logObject,e)},Logger}());JL.Logger=Exception,JL.createAjaxAppender=function(appenderName){return new AjaxAppender(appenderName)},JL.createConsoleAppender=function(appenderName){return new ConsoleAppender(appenderName)},Exception=new("undefined"!=typeof window?AjaxAppender:ConsoleAppender)(""),JL.__=new JL.Logger(""),JL.__.setOptions({level:JL.getDebugLevel(),appenders:[Exception]})}(JL=JL||{}),"undefined"!=typeof exports&&(exports.__esModule=!0,exports.JL=JL),"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL}),"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL),"undefined"==typeof window||window.onerror||(window.onerror=function(errorMsg,url,lineNumber,column,errorObj){if((0!==url.length||0!==lineNumber||0!=column)&&-1!==url.search("panchang")&&-1===navigator.userAgent.search("Googlebot"))return JL("onerrorLogger").fatalException({msg:"Uncaught Exception",userAgent:navigator.userAgent,pageUrl:location.pathname,errorMsg:errorMsg?errorMsg.message||errorMsg:"",url:url,"line number":lineNumber,column:column},errorObj),!1}),"undefined"==typeof window||window.onunhandledrejection||(window.onunhandledrejection=function(event){JL("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:event.reason?event.reason.message:event.message||null},event.reason)});