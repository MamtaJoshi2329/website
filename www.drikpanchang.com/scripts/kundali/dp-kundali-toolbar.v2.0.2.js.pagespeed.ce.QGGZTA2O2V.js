"use strict";const DpDivisionContext={kPrimary:"primary",kSecondary:"secondary",kConjoined:"conjoined"};Object.freeze(DpDivisionContext);class DpKundaliToolbar{constructor(){this.division_context_=null;var anchorGrahaList=dpCookiesMngr.getCookie("drik-kundali-anchor-graha"),kundaliDivisionList=dpCookiesMngr.getCookie("drik-kundali-division-type"),kundaliChartStyle=dpCookiesMngr.getCookie("drik-kundali-chart-style");this.anchor_graha_list_=0===anchorGrahaList.length?"lagna,lagna":anchorGrahaList,this.kundali_division_list_=0===kundaliDivisionList.length?"d1,d9":kundaliDivisionList,this.kundali_chart_style_=0===kundaliChartStyle.length?"north":kundaliChartStyle}registerButtonClickListeners(){let self=this;dpInputHandler.overrideKundaliReloadFunctionality();var dpResultContent=$("#dp-result-content");dpResultContent.on("click",".dpChartTypeButton",function(){var chartStyleElementId=$(this).parent().attr("id"),chartStyleElementId=(self.division_context_="dp-chart-type-selector-second"===chartStyleElementId?DpDivisionContext.kSecondary:DpDivisionContext.kPrimary,self.kundali_chart_style_=$(this).attr("data-chart-type"),dpPageForm.validateKundaliForm(),dpCookiesMngr.setCookie("drik-kundali-chart-style",self.kundali_chart_style_,365),self.getKundaliDivisionPayload(!0,!1)),chartStyleElementId=JSON.stringify({dp_payload:chartStyleElementId});dpKundaliPost.postAjaxDataPayload("dp-result-content",chartStyleElementId)}),dpResultContent.on("click",".dpGrahaSelectorButton",function(){dpPageForm.validateKundaliForm();var anchorGrahaSelected=$(this).attr("data-planet-anchor"),anchorGrahaList=self.anchor_graha_list_.split(","),anchorGrahaSelected=(anchorGrahaList[0]=anchorGrahaSelected,self.anchor_graha_list_=anchorGrahaList.join(","),dpCookiesMngr.setCookie("drik-kundali-anchor-graha",self.anchor_graha_list_,365),self.getKundaliDivisionPayload()),anchorGrahaList=JSON.stringify({dp_payload:anchorGrahaSelected}),anchorGrahaSelected=(dpKundaliPost.postAjaxDataPayload("dp-result-content",anchorGrahaList),document.getElementsByClassName("dpGrahaSelectorButton"));dpPageForm.updateButtonsCSSStyle(anchorGrahaSelected,"dpSelectedItem"),$(this).addClass("dpSelectedOption")}),this.initializeTabsHolder("#dp-division-table-tabs"),this.handleKundaliAnchorGrahaSelectListener(dpResultContent,!1),this.handleKundaliDivisionSelectListener(dpResultContent,!1),dpResultContent.on("click",".dpShadaBalaButton",function(){var shadabalaButtonElement=$(".dpShadaBalaButton");self.handleActionOnKundaliToolbarButtonClick("shada-bala",shadabalaButtonElement)}),dpResultContent.on("click",".dpBhavaBalaButton",function(){var bhavabalaButtonElement=$(".dpBhavaBalaButton");self.handleActionOnKundaliToolbarButtonClick("bhava-bala",bhavabalaButtonElement)}),dpResultContent.on("click",".dpKundaliDivisionButton",function(){dpPageForm.validateKundaliForm(),this.kundali_division_list_=$(this).attr("data-kundali-division"),dpCookiesMngr.setCookie("drik-kundali-division-type",this.kundali_division_list_,365);var payloadData=self.getKundaliDivisionPayload(),payloadData=JSON.stringify({dp_payload:payloadData}),payloadData=(dpKundaliPost.postAjaxDataPayload("dp-result-content",payloadData),document.getElementsByClassName("dpKundaliDivisionButton"));dpPageForm.updateButtonsCSSStyle(payloadData),$(this).addClass("dpSelectedOption")}),dpResultContent.on("click",".dpActionToolbarButton",function(event){event.stopPropagation();event=$(this).offset().left;let innerToolbarElement=$(".dpKundaliActionToolbar");innerToolbarElement.toggle(),window.innerWidth<1124&&innerToolbarElement.css({left:event,right:"unset"}),$(this).toggleClass("dpActiveActionToolbarButton"),$("body").on("click",function(){$(".dpActionToolbarButton").removeClass("dpActiveActionToolbarButton"),innerToolbarElement.is(":visible")&&innerToolbarElement.css({display:"none"})})}),dpResultContent.on("click",".dpKundaliReadingButton",function(){var kundaliReadingButtonElement=$(".dpKundaliReadingButton");self.handleActionOnKundaliToolbarButtonClick("kundali-reading",kundaliReadingButtonElement)}),dpResultContent.on("click",".dpKundaliDrikReadingButton",function(){var kundaliReadingButtonElement=$(".dpKundaliDrikReadingButton");self.handleActionOnKundaliToolbarButtonClick("drik-kundali-reading",kundaliReadingButtonElement)}),dpResultContent.on("click",".dpKundaliPanchangButton",function(){var panchangamButtonElement=$(".dpKundaliPanchangButton");self.handleActionOnKundaliToolbarButtonClick("panchangam",panchangamButtonElement)}),dpResultContent.on("click",".dpKundaliYogaButton",function(){var kundaliYogaButtonElement=$(".dpKundaliYogaButton");self.handleActionOnKundaliToolbarButtonClick("kundali-yoga",kundaliYogaButtonElement)}),dpResultContent.on("click",".dpAshtakaVargaButton",function(){var ashtakavargaButtonElement=$(".dpAshtakaVargaButton");self.handleActionOnKundaliToolbarButtonClick("ashtaka-varga",ashtakavargaButtonElement)}),$(".dpFormResult").on("click",".dpFloatResult",function(){$(".dpFloatResult").removeClass("dpFocusedFloatResult"),$(this).addClass("dpFocusedFloatResult")})}handleActionOnKundaliToolbarButtonClick(analysisRequest,toolbarButtonElement){toolbarButtonElement.prop("disabled",!0).addClass("dpDisabledButton"),dpPageForm.validateKundaliForm();toolbarButtonElement=dpKundaliPost.getAjaxRequestDataPayload(),this.addKundaliAnalysisPayload(analysisRequest,toolbarButtonElement),analysisRequest=JSON.stringify({dp_payload:toolbarButtonElement});dpKundaliPost.postAjaxDataPayload("dp-result-content",analysisRequest)}handleKundaliAnchorGrahaSelectListener(resultContentElement,secondKundaliFlag){let self=this;resultContentElement.on("change",secondKundaliFlag?"#dp-kundali-graha-selector-second":"#dp-kundali-graha-selector",function(){self.division_context_="dp-kundali-graha-selector-second"===this.id?DpDivisionContext.kSecondary:DpDivisionContext.kPrimary,self.handleKundaliAnchorGrahaChange(this),self.updateUpperOrLowerSectionTabsTitle("dp-kundali-graha-selector","dp-kundali-division-selector")})}handleKundaliDivisionSelectListener(resultContentElement,secondKundaliFlag){let self=this;resultContentElement.on("change",secondKundaliFlag?"#dp-kundali-division-selector-second":"#dp-kundali-division-selector",function(){self.division_context_="dp-kundali-division-selector-second"===this.id?DpDivisionContext.kSecondary:DpDivisionContext.kPrimary,self.handleKundaliDivisionChange(this),self.updateUpperOrLowerSectionTabsTitle("dp-kundali-graha-selector","dp-kundali-division-selector")})}handleKundaliDivisionChange(thisRef){var targetId=$(thisRef).prop("id"),kundaliDivisionList=(dpPageForm.validateKundaliForm(),this.kundali_division_list_.split(",")),targetId=("dp-kundali-division-selector-second"===targetId?kundaliDivisionList[1]=$(thisRef).val():kundaliDivisionList[0]=$(thisRef).val(),this.kundali_division_list_=kundaliDivisionList.join(","),dpCookiesMngr.setCookie("drik-kundali-division-type",this.kundali_division_list_,365),this.getKundaliDivisionPayload(!0,!0)),thisRef=JSON.stringify({dp_payload:targetId});dpKundaliPost.postAjaxDataPayload("dp-result-content",thisRef)}handleKundaliAnchorGrahaChange(thisRef){var targetId=$(thisRef).prop("id"),anchorGrahaList=(dpPageForm.validateKundaliForm(),this.anchor_graha_list_.split(",")),targetId=("dp-kundali-graha-selector-second"===targetId?anchorGrahaList[1]=$(thisRef).val():anchorGrahaList[0]=$(thisRef).val(),this.anchor_graha_list_=anchorGrahaList.join(","),dpCookiesMngr.setCookie("drik-kundali-anchor-graha",this.anchor_graha_list_,365),this.getKundaliDivisionPayload(!0,!0)),thisRef=JSON.stringify({dp_payload:targetId});dpKundaliPost.postAjaxDataPayload("dp-result-content",thisRef)}initializeTabsHolder(tabsHolderID){$(tabsHolderID).show().tabs({active:0,hide:{effect:"fadeOut",duration:150},show:{effect:"fadeIn",duration:150}})}addKundaliDivisionAnalysisPayload(kundaliPayload){kundaliPayload.kundali_analysis={kundali_part:"division",anchor_graha:this.anchor_graha_list_,kundali_division:this.kundali_division_list_,chart_style:this.kundali_chart_style_}}addKundaliAnalysisPayload(kundaliAnalysisRequest,kundaliPayload){kundaliPayload.kundali_analysis={kundali_part:kundaliAnalysisRequest}}addKundaliDataFilterPayload(kundaliPayload,chartDataFlag,tableDataFlag){let divisionalContext=DpDivisionContext.kPrimary;var yugmaKundaliStatusFlag;"function"==typeof DpKundaliLayoutBuilder&&(yugmaKundaliStatusFlag=dpPageForm.layout_builder_.yugma_kundali_ui_status_flag_,divisionalContext=yugmaKundaliStatusFlag?DpDivisionContext.kConjoined:DpDivisionContext.kPrimary),null!==this.division_context_&&(divisionalContext=this.division_context_),kundaliPayload.kundali_analysis.data_filter={chart_data:chartDataFlag,table_data:tableDataFlag,division_context:divisionalContext},DpKundaliContext.kKundali===dpPageForm.kundali_.getContext&&(kundaliPayload.kundali_analysis.data_filter.kundali_meta={geo_tooltip:!0,kundali_datetime:!0},DpDBKundaliContext.kSave!==dpPageForm.kundali_.getDBContext&&DpDBKundaliContext.kNew!==dpPageForm.kundali_.getDBContext&&DpDBKundaliContext.kEdit!==dpPageForm.kundali_.getDBContext||(kundaliPayload.kundali_analysis.data_filter.kundali_meta.kundali_id=!0))}showKundaliDivisionAnalysisResult(analysisRequest,resultElementId,ajaxResultData){if(this.division_context_=null,DpKundaliContext.kKundali===dpPageForm.kundali_.getContext){analysisRequest=analysisRequest.data_filter.kundali_meta;if(void 0!==analysisRequest&&analysisRequest.hasOwnProperty("kundali_id")){let saveKundaliStatus=JSON.parse(ajaxResultData).response.kundali_meta.kundali_id;saveKundaliStatus<-1&&-100!==saveKundaliStatus&&(DpDialog.showAlertMessage(dpFailedToSaveKundaliString,DpImg.kImgErrorIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},5e3),saveKundaliStatus=-1),DpDBKundaliContext.kEdit!==dpPageForm.kundali_.getDBContext&&(dpPageForm.kundali_.setID=saveKundaliStatus),console.log("updated Kundali ID "+dpPageForm.kundali_.getID)}dpPageForm.layout_builder_.updateIndividualKundaliSectionBlockUI(ajaxResultData),dpPageForm.layout_builder_.yugma_kundali_ui_status_flag_&&this.initializeTabsHolder("#dp-division-table-tabs-second"),this.initializeTabsHolder("#dp-division-table-tabs"),this.performUIChangesBasedOnCelebrityContext(),dpPageActionbar.updateKundaliActionbarButtons(),DpKundaliPost.removePageOverlay()}else this.updateDefaultKundaliSectionUI(resultElementId,ajaxResultData)}updateKundaliDataInLocalStorage(payloadLookup){payloadLookup=dpPageForm.prepareAndGetKundaliDataFromPayload(payloadLookup),payloadLookup=JSON.stringify(payloadLookup);localStorage.setItem(dpPageForm.kundali_list_popup_.clicked_kundali_key_,payloadLookup)}updateUpperOrLowerSectionTabsTitle(grahaSelectorID,divisionSelectorID){var secondaryKundaliIdSuffix="secondary"===this.division_context_?"-second":"",grahaSelectorID=$("#"+grahaSelectorID+secondaryKundaliIdSuffix+" option:selected").text()+", "+$("#"+divisionSelectorID+secondaryKundaliIdSuffix+" option:selected").text().split("-")[0];let sectionTabsElement="";var divisionSelectorID=$("#dp-upper-section-tabs > ul"),secondaryKundaliIdSuffix=$("#dp-lower-section-tabs > ul");divisionSelectorID.is(":visible")?sectionTabsElement=divisionSelectorID:secondaryKundaliIdSuffix.is(":visible")&&(sectionTabsElement=secondaryKundaliIdSuffix),""!==sectionTabsElement&&(divisionSelectorID="secondary"===this.division_context_?".dpJQuerySecondTab":".dpJQueryFirstTab",secondaryKundaliIdSuffix=sectionTabsElement.find(divisionSelectorID),$(secondaryKundaliIdSuffix[0]).find("a").text(grahaSelectorID))}performUIChangesBasedOnCelebrityContext(){var celebrityImageSrc,kundaliReadingButton=$("#dp-result-content .dpKundaliReadingButton"),selected_kundali_data=(dpPageForm.handler_.celebrity_kundali_flag_=!1,dpPageForm.kundali_search_.selected_kundali_data_);0<(void 0!==selected_kundali_data.kundaliTag?selected_kundali_data.kundaliTag:"").length?(dpPageForm.handler_.celebrity_kundali_flag_=!0,kundaliReadingButton.removeClass("dpDisplayNone"),kundaliReadingButton.addClass("dpInlineBlock"),celebrityImageSrc=selected_kundali_data.imageData[0],selected_kundali_data=selected_kundali_data.imageData[1],kundaliReadingButton.find("img").attr("src",celebrityImageSrc),kundaliReadingButton.find("img").attr("alt",selected_kundali_data)):DpDBKundaliContext.kOpen!==dpPageForm.kundali_.getDBContext&&DpDBKundaliContext.kNew!==dpPageForm.kundali_.getDBContext||kundaliReadingButton.is(":visible")&&kundaliReadingButton.addClass("dpDisplayNone"),window.location.href.includes("?")&&window.history.replaceState({},document.title,location.pathname)}updateDefaultKundaliSectionUI(resultElementId,resultHTML){resultElementId=document.getElementById(resultElementId),resultElementId.innerHTML=resultHTML,resultHTML=resultElementId.getElementsByClassName("dpAjaxScript");0!==resultHTML.length&&(DpKundaliPost.evaluateAjaxScript(resultHTML),dpKundaliChart.drawKundaliChartOnCanvas(DpKundaliCanvasID.kPrimary),this.updatePlanetaryPositionsTable())}updatePlanetaryPositionsTable(){var planetTableElement,planetaryPositionDialog=$("#dp-planetary-position-table-float-id");0!==planetaryPositionDialog.length&&(planetTableElement=document.getElementById("dp-planetary-position-table-id"),planetaryPositionDialog.html(planetTableElement.innerHTML))}showKundaliAnalysisResult(analysisRequest,resultElementId,resultHTML){switch(analysisRequest.kundali_part){case"shada-bala":this.showShadabalaTable(resultHTML);break;case"bhava-bala":this.showBhavabalaTable(resultHTML);break;case"division":this.showKundaliDivisionAnalysisResult(analysisRequest,resultElementId,resultHTML);break;case"kundali-reading":case"drik-kundali-reading":this.showKundaliReadingResultDialog(resultHTML);break;case"panchangam":this.showKundaliPanchangamResultDialog(resultHTML);break;case"kundali-yoga":this.showKundaliYogaResultDialog(resultHTML);break;case"ashtaka-varga":this.showAshtakavargaTable(resultHTML)}}getKundaliDivisionPayload(chartDataFlag,tableDataFlag){var payloadData=dpKundaliPost.getAjaxRequestDataPayload();return this.addKundaliDivisionAnalysisPayload(payloadData),this.addKundaliDataFilterPayload(payloadData,chartDataFlag,tableDataFlag),payloadData}showShadabalaTable(resultHTML){dpDialogHeightTopMargin=0;var resultHTML=dpSettingsToolbar.createDialogPopup(resultHTML,620,920,20,"dp-shadabala-dialog-id"),dashaTitle=(resultHTML.bind("dialogclose",function(event,ui){dpSettingsToolbar.customizeDialogBind(event),$(".dpShadaBalaButton").prop("disabled",!1).removeClass("dpDisabledButton")}),resultHTML.find(".dpShadabalaWrapper").attr("data-title")),resultHTML=(resultHTML.dialog("option","title",dashaTitle),document.getElementById("dp-shadabala-header-canvas"));this.drawBalaChartCanvas(dpKundaliShadabalaChartData,resultHTML,{barSize:[0,0],barTopLabel:[12,-2],barBottomLabel:[12,-10]}),$(".dpBalaAccordion").accordion({active:!1,collapsible:!0,header:".dpExpandRow"})}showBhavabalaTable(resultHTML){dpDialogHeightTopMargin=0;var heightOffset=550<$(window).height()?120:5,resultHTML=dpSettingsToolbar.createDialogPopup(resultHTML,505,900,heightOffset,"dp-bhavabala-dialog-id"),heightOffset=(resultHTML.bind("dialogclose",function(event,ui){dpSettingsToolbar.customizeDialogBind(event),$(".dpBhavaBalaButton").prop("disabled",!1).removeClass("dpDisabledButton")}),resultHTML.find(".dpBhavabalaWrapper").attr("data-title")),resultHTML=(resultHTML.dialog("option","title",heightOffset),dpEssential.mobile_device_flag_&&$(window).width()<500?2:10),heightOffset={barSize:[-30,0],barTopLabel:[resultHTML,-2],barBottomLabel:[resultHTML,-10]},resultHTML=document.getElementById("dp-bhavabala-header-canvas");this.drawBalaChartCanvas(dpKundaliBhavabalaChartData,resultHTML,heightOffset)}drawBalaChartCanvas(chartData,chartCanvas,barOffset){chartCanvas.width=chartCanvas.getBoundingClientRect().width,chartCanvas.height=chartCanvas.getBoundingClientRect().height;new DpBarChart({canvas:chartCanvas,seriesName:"",padding:30,gridScale:20,gridColor:"#781E00",data:chartData,offset:{maxValue:[30,0],bar:[-8,-4],barTopLabel:barOffset.barTopLabel,barBottomLabel:barOffset.barBottomLabel,barBottomLine:[-28,-28],barInsideLabel:[-5,10],barInsideTranslate:[0,-60],barSize:barOffset.barSize},colors:["#E75480","#586306","#B80000","#38a592","#47ABCC","#C72B50","#9B870C","#4B4F56","#681CA5","#38A592","#B8694A","#A523A4"]}).drawChart()}showKundaliReadingResultDialog(resultHTML){dpDialogHeightTopMargin=0;resultHTML=dpSettingsToolbar.createDialogPopup(resultHTML,620,500,20,"dp-kundali-reading-id");resultHTML.bind("dialogclose",function(event,ui){dpSettingsToolbar.customizeDialogBind(event),$(".dpKundaliReadingButton, .dpKundaliDrikReadingButton").prop("disabled",!1).removeClass("dpDisabledButton")});let kundaliName=dpPageForm.kundali_.getName;var kundaliNameTitleElement=$(".dpKundaliReadingTitle");0!==kundaliNameTitleElement.length&&(kundaliName=kundaliNameTitleElement.attr("data-kundali-dialog-title")),resultHTML.dialog("option","title",kundaliName),$("#dp-kundali-reading-accordion").accordion({active:0,collapsible:!0,heightStyle:"content",header:".dpContentTitle"})}showKundaliPanchangamResultDialog(resultHTML){dpDialogHeightTopMargin=0;var resultHTML=dpSettingsToolbar.createDialogPopup(resultHTML,620,400,20,"dp-kundali-panchangam-id"),panchangamTitle=(resultHTML.bind("dialogclose",function(event,ui){dpSettingsToolbar.customizeDialogBind(event),$(".dpKundaliPanchangButton").prop("disabled",!1).removeClass("dpDisabledButton")}),$(".dpKundaliPanchangamTitle").attr("data-kundali-dialog-title"));resultHTML.dialog("option","title",panchangamTitle),resultHTML.dialog({resizable:!1}),$("#dp-kundali-panchangam-accordion").accordion({active:0,collapsible:!0,heightStyle:"content",header:".dpKundaliAccordion"})}showAshtakavargaTable(resultHTML){dpDialogHeightTopMargin=0;var resultHTML=dpSettingsToolbar.createDialogPopup(resultHTML,620,425,20,"dp-ashtakavarga-id"),ashtakavargaTitle=(resultHTML.bind("dialogclose",function(event,ui){dpSettingsToolbar.customizeDialogBind(event),$(".dpAshtakaVargaButton").prop("disabled",!1).removeClass("dpDisabledButton")}),$(".dpKundaliAshtakavargaTitle").attr("data-ashtakavarga-dialog-title"));resultHTML.dialog("option","title",ashtakavargaTitle),resultHTML.dialog({resizable:!1})}showKundaliYogaResultDialog(resultHTML){dpDialogHeightTopMargin=0;var resultHTML=dpSettingsToolbar.createDialogPopup(resultHTML,620,490,20,"dp-kundali-yoga-id"),kundaliYogaTitle=(resultHTML.bind("dialogclose",function(event,ui){dpSettingsToolbar.customizeDialogBind(event),$(".dpKundaliYogaButton").prop("disabled",!1).removeClass("dpDisabledButton"),$("body, .dpCloseElementInfoPopup").off("click")}),$(".dpKundaliYogaTitle").attr("data-kundali-yoga-title"));resultHTML.dialog("option","title",kundaliYogaTitle),resultHTML.dialog({resizable:!1}),this.setYogaPopupTooltipHandler()}setYogaPopupTooltipHandler(){var iconActionEvent=dpEssential.mobile_device_flag_?"click":"mouseover";$(".dpKundaliYogaTable .dpInfoIcon").on(iconActionEvent,function(event){event.stopPropagation(),dpPageTooltipPopup.handleElementPopupDismiss(event.target);var yogaTooltipObject,popupContentWrapperElement=$(event.target).parent(),yogaHexCode=$(popupContentWrapperElement).data("element-info");let yogaTooltipDictionary={};try{null!==localStorage.getItem(dpPageTooltipPopup.dictionary_cache_key_)&&(yogaTooltipDictionary=JSON.parse(localStorage.getItem(dpPageTooltipPopup.dictionary_cache_key_)))}catch(e){console.log(e)}let tooltipDisplayFlag=!1;void 0!==yogaTooltipDictionary[yogaHexCode]&&(yogaTooltipObject=yogaTooltipDictionary[yogaHexCode]).timestamp>(new Date).getTime()&&(tooltipDisplayFlag=!0,dpPageTooltipPopup.closeAjaxRequestElementPopup(),dpPageTooltipPopup.showElementPopupFromCache(event,yogaTooltipObject.value)),!1===tooltipDisplayFlag&&dpPageTooltipPopup.postElementPopupAjaxPayload(event,popupContentWrapperElement,{kundali_yoga_info:yogaHexCode})})}}