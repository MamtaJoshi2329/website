"use strict";const DpKundaliTag={kAll:"all",kCelebrities:"celebrities"};Object.freeze(DpKundaliTag);class DpKundaliHandler extends DpDialogHandler{constructor(){super(),this.celebrity_kundali_flag_=!1}getLoginConfirmationMessageHTML(){return'<div class="dpLeftAlignText">'+dpSignInSuggestionString+'</div><div style="padding:0 5px 20px;"><label for="dp-save-without-login"><input type="radio" id="dp-save-without-login" name="radio_button_login_option" value="'+dpWithoutLoginString+'"> '+dpWithoutLoginString+'</label><label for="dp-save-with-login"><input type="radio" id="dp-save-with-login" name="radio_button_login_option" value="'+dpLoginString+'" checked autofocus> '+dpLoginString+"</label></div>"}getDataConfirmationMessageHTML(){let ayanamshaHTML="";var ayanamshaElement=document.getElementById("dp-ayanamsha"),kundali_=dpPageForm.kundali_,selectedOptionIndex=(null!==ayanamshaElement&&(selectedOptionIndex=ayanamshaElement.selectedIndex,ayanamshaElement=ayanamshaElement.options[selectedOptionIndex].text,selectedOptionIndex="chitra-paksha"!==kundali_.getAyanamsha?"dpHighlightedAyanamsha":"",ayanamshaHTML='<div class="dpFlex"><div class="dpPopupLabel">'+dpAyanamshaString+': </div><div class="'+selectedOptionIndex+'">'+ayanamshaElement+"</div> </div>"),this.getKundaliFormattedDateForConfirmation());return'<div class="dpLeftAlignText">'+dpMessageString+"</div><br>"+('<div><div class="dpFlex"> <div class="dpPopupLabel">'+dpDateString+": </div><div>"+selectedOptionIndex+'</div> </div><div class="dpFlex"> <div class="dpPopupLabel">'+dpTimeString+": </div><div>"+kundali_.getTime+'</div> </div><div class="dpFlex"> <div class="dpPopupLabel">'+dpCityString+": </div><div>"+kundali_.geo_.getCity+'</div> </div><div class="dpFlex"> <div class="dpPopupLabel">'+dpStateString+": </div><div>"+kundali_.geo_.getState+'</div> </div><div class="dpFlex"><div class="dpPopupLabel">'+dpCountryString+": </div><div>"+kundali_.geo_.getCountry+"</div> </div> "+ayanamshaHTML+'<br><div class="dpLeftAlignText dpDullLabel"><small>'+dpPopupDateFormatString+'</small></div><div class="dpLeftAlignText dpDullLabel"><small>'+dpPopupTimeFormatString+"</small></div><br></div><br>")}getKundaliFormattedDateForConfirmation(){let kundaliDisplayDate=dpPageForm.kundali_.getDate;if("julian"===dpPageForm.kundali_.getDateType){var kundaliYear,dateEpochSignSelector=$(".dpDateEpochSignSelector"),epochSignHTML=dateEpochSignSelector.find("option:selected").html(),dateEpochSignSelector=dateEpochSignSelector.find("option:selected").val();let kundaliDate=dpPageForm.kundali_.getDate;"negative-epoch"===dateEpochSignSelector&&(kundaliYear=(dateEpochSignSelector=kundaliDate.split("/"))[2],parseInt(dateEpochSignSelector[2],0)<0)&&(kundaliYear=dateEpochSignSelector[2].substring(1),kundaliDate=dateEpochSignSelector[0]+"/"+dateEpochSignSelector[1]+"/"+kundaliYear),kundaliDisplayDate=kundaliDate+" "+epochSignHTML}return kundaliDisplayDate}showDataConfirmationDialog(){var formConfirmationMessage;dpPageForm.validateKundaliForm()||(formConfirmationMessage=this.getDataConfirmationMessageHTML(),this.showConfirmationBox(formConfirmationMessage,this.proceedAfterDataConfirmation.bind(this),DpDialogHandler.removeActionConfirmationBoxAndOverlay))}proceedAfterDataConfirmation(){var dbContext=dpPageForm.kundali_.getDBContext;dpSignIn.authenticated_user_flag_||DpDBKundaliContext.kEdit===dbContext||DpDBKundaliContext.kListItemEdit===dbContext?(this.addUserDataInCloudDatabase(),DpDialogHandler.removeActionConfirmationBoxAndOverlay()):this.showSignInOptions()}handleDataOnSuccessfulSignIn(){DpDialogHandler.removeSignInOverlay(),dpPostContext=DpPostContext.kServerSignIn,DpKundaliContext.kJanmaKundali===dpPageForm.kundali_.getContext?this.reloadKundaliPageWithExistingData(DpPg.kKundaliOpen):this.postKundaliRequestAfterSuccessfulSignIn()}postKundaliRequestAfterSuccessfulSignIn(){var kundaliDataPayload=dpPageForm.handler_.getKundaliPayload(),kundaliDataPayload=(DpKundaliContext.kMuhurta===dpPageForm.kundali_.getContext&&dpPageActionbar.processSavedPayloadAfterSignIn(kundaliDataPayload),this.handleFormCollapseButtonAndFields(),JSON.stringify({dp_payload:kundaliDataPayload}));dpKundaliPost.postAjaxDataPayload("dp-result-content",kundaliDataPayload),$("#dp-result-content .dpEditKundaliButton").addClass("dpInlineBlock"),$("#dp-result-content .dpSaveKundaliButton").addClass("dpDisplayNone")}reloadKundaliPageWithExistingData(pageURL){var payloadData=dpPageToolbar.getKundaliDivisionPayload(),payloadData=JSON.stringify({dp_payload:payloadData});dpPageForm.openKundaliPageWithPostedData(pageURL,payloadData)}setContextBeforeLaunchingPopup(){dpPostContext=DpPostContext.kKundali}handleDataWithoutUserSignIn(){dpPostContext=DpPostContext.kServerSignIn,document.getElementById("dp-save-without-login").checked&&(dpPageForm.kundali_.setID=-100,this.addUserDataInLocalCache(),DpDialogHandler.removeActionConfirmationBoxAndOverlay())}addUserDataInCloudDatabase(){var payloadData=this.getKundaliPayload(),payloadData=JSON.stringify({dp_payload:payloadData});DpKundaliContext.kJanmaKundali===dpPageForm.kundali_.getContext?(DpDialog.showAlertMessage(dpWaitGettingResultString,DpImg.kImgSpinnerIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},5e3),dpPageForm.openKundaliPageWithPostedData(DpPg.kKundaliOpen,payloadData)):dpKundaliPost.postAjaxDataPayload("dp-result-content",payloadData),this.handleFormCollapseButtonAndFields(),this.handleActionOnKundaliOpenDialogs(),DpKundaliContext.kMuhurta===dpPageForm.kundali_.getContext&&dpPageActionbar.handleExitAfterKundaliSelection()}handleFormCollapseButtonAndFields(){$(".dpFormFieldsCollapse").slideUp();var expandButtonImg=$(".dpFormCollapseButton img");expandButtonImg.attr("src",dpExpandIconURL),expandButtonImg.attr("data-alt-src",dpCompressIconURL)}handleActionOnKundaliOpenDialogs(){$(".dpForm").data("changed")&&dpPageForm.removeOpenDialogInstance()}addUserDataInLocalCache(){var payloadData=this.getKundaliPayload(),dbContext=dpPageForm.kundali_.getDBContext;(DpDBKundaliContext.kEdit!==dbContext&&DpDBKundaliContext.kListItemEdit!==dbContext||"-100"===payloadData.kundali_id)&&dpPageForm.kundali_local_storage_.saveKundaliDataInLocalStorage(),this.addUserDataInCloudDatabase()}getKundaliPayload(){let payloadData;var context=dpPageForm.kundali_.getContext;return payloadData=DpKundaliContext.kKundali===context||DpKundaliContext.kMangalaDosha===context||DpKundaliContext.kKalasarpaDosha===context?dpPageToolbar.getKundaliDivisionPayload():DpKundaliContext.kMuhurta===context?(dpPageForm.populateKundaliWithFormData(),dpActivityMuhurtaDates.getPersonalizedMuhurtaPayload()):dpKundaliPost.getAjaxRequestDataPayload()}handlePopupFlowAborted(){dpPostContext=DpPostContext.kServerSignIn,$(".dpUserKundaliSaveButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpSaveKundaliButton").prop("disabled",!1).removeClass("dpDisabledButton"),DpDialogHandler.removeActionConfirmationBoxAndOverlay()}updateCitySearchAndDatePickerValues(payloadLookup,ajaxResultData){var kundaliDataFilter=payloadLookup.kundali_analysis.data_filter;void 0!==kundaliDataFilter&&kundaliDataFilter.hasOwnProperty("kundali_meta")&&(ajaxResultData=(kundaliDataFilter=JSON.parse(ajaxResultData)).response.kundali_meta.geo_tooltip,document.getElementsByClassName("dpLocationIconDiv")&&($(".dpLocationIconDiv").attr("title",ajaxResultData),document.getElementById("dp-direct-city-search"))&&(ajaxResultData=payloadLookup.kundali_city,ajaxResultData+=", "+payloadLookup.kundali_country,document.getElementById("dp-direct-city-search").value=ajaxResultData),document.getElementById("dp-date-time-picker"))&&(payloadLookup=kundaliDataFilter.response.kundali_meta.kundali_datetime,document.getElementById("dp-date-time-picker").value=payloadLookup)}}class DpActionbar{takeActionOnKundaliSelect(){throw new Error("Method 'takeActionOnKundaliSelect()' must be implemented.")}handleKundaliButtonsOnPopupListClose(){throw new Error("Method 'handleKundaliButtonsOnPopupListClose()' must be implemented.")}handleActionOnKundaliActionbarButtons(){throw new Error("Method 'handleActionOnKundaliActionbarButtons()' must be implemented.")}processSavedPayloadAfterSignIn(){throw new Error("Method 'processSavedPayloadAfterSignIn()' must be implemented.")}constructor(){this.kundali_list_post_request_=null}postKundaliListDataPayload(kundaliTag){let self=this;DpDialog.showAlertMessage(dpOpenKundaliListWaitResultString,DpImg.kImgSpinnerIcon);this.kundali_list_post_request_=$.ajax({type:"POST",cache:!1,url:"/ajax/kundali/dp-kundali-popup-list.php",data:JSON.stringify({dp_payload:{"kundali-tag":kundaliTag}}),contentType:"application/json; charset=utf-8",beforeSend:function(){null!==self.kundali_list_post_request_&&self.kundali_list_post_request_.abort()},success:function(kundaliData){$(".dpPopup").slideUp(100);kundaliData=JSON.parse(kundaliData);DpKundaliTag.kAll===kundaliTag&&dpPageForm.kundali_local_storage_.populateKundaliPopupListFromLocalStorage(kundaliData,21),dpPageForm.kundali_list_popup_.showKundaliListDialog(kundaliData.kundali_list,kundaliTag),self.kundali_list_post_request_=null},error:function(){dpPageForm.form_submit_context_flag_=!1,DpDialog.showAlertMessage(dpFailedToGetResultString,DpImg.kImgErrorIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},5e3),$(".dpDisabledButton").prop("disabled",!1).removeClass("dpDisabledButton"),self.kundali_list_post_request_=null}})}}