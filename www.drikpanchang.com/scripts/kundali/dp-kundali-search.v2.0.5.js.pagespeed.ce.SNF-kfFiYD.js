"use strict";class DpKundaliSearch{constructor(){this.search_icon_=null,this.month_localization_list_=[],this.weekday_localization_list_=[],this.am_pm_localization_list_=[],this.descriptive_datetime_format_=null,this.selected_kundali_data_=[]}prepareForKundaliSearch(){String.prototype.format||(String.prototype.format=function(){let args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return void 0!==args[number]?args[number]:match})});var savedThemeCookie=dpCookiesMngr.getCookie("drik-website-theme"),domainName=window.location.protocol+"//"+window.location.hostname,personIcon=domainName+DpImg.kImgKundaliSearchPic,domainName=domainName+DpImg.kImgKundaliSearchPicModern,savedThemeCookie=(this.search_icon_="classic"===savedThemeCookie?personIcon:domainName,$("#dp-name, #dp-second-name")),personIcon=dpPageForm.kundali_.getContext;DpKundaliContext.kKundali!==personIcon&&DpKundaliContext.kKundaliList!==personIcon&&this.prepareKundaliSearchAutocomplete(savedThemeCookie,null)}prepareKundaliSearchAutocomplete(selectorElement,kundaliListDialogElement){let kundaliLocalCache={},xmlHttpRequest,self=this;selectorElement.autocomplete({source:function(request,response){let inputTerm=request.term;if((inputTerm=(inputTerm=inputTerm.trim().toLowerCase()).replace(/\s\s+/g," "))in kundaliLocalCache){$(this).removeClass("ui-autocomplete-loading");var cachedData=kundaliLocalCache[inputTerm];null!==kundaliListDialogElement&&0<cachedData.kundali_list.length&&$(".dpDialogKundaliListWrapper").hide(),response($.map(cachedData.kundali_list,function(item){return self.getKundaliSearchListData(item)}))}else if(dpSignIn.authenticated_user_flag_){try{void 0!==xmlHttpRequest&&xmlHttpRequest.abort()}catch(e){}xmlHttpRequest=$.ajax({url:"/ajax/kundali/dp-kundali-search.php",dataType:"json",data:{"kundali-hint":request.term},success:function(data){DpPgContext.tagSearchEventInGA4("kundali_search",request.term),null!==kundaliListDialogElement&&0<data.kundali_list.length&&$(".dpDialogKundaliListWrapper").hide(),$(this).removeClass("ui-autocomplete-loading"),kundaliLocalCache[inputTerm]=data,response($.map(data.kundali_list,function(item){return self.getKundaliSearchListData(item)}))},error:function(){$(this).removeClass("ui-autocomplete-loading")}})}else{$(this).removeClass("ui-autocomplete-loading");cachedData=[];cachedData.kundali_list=[],dpPageForm.kundali_local_storage_.populateKundaliDataInLocalStorage(inputTerm,cachedData),null!==kundaliListDialogElement&&0<cachedData.kundali_list.length&&$(".dpDialogKundaliListWrapper").hide(),response($.map(cachedData.kundali_list,function(item){return self.getKundaliSearchListData(item)}))}},minLength:2,autoFocus:!0,select:function(event,ui){self.selected_kundali_data_=ui.item;var geoElementId="dp-second-name"===document.activeElement.id?"dp-second-city-search":"dp-city-search";dpPageForm.fillFormWithSelectedItem(ui.item.geoData,geoElementId),dpPageForm.fillFormWithSelectedKundaliItem(ui.item.kundaliData,document.activeElement.id),DpKundaliContext.kMuhurta===dpPageForm.kundali_.getContext&&dpPageForm.populateKundaliWithFormData(),null!==kundaliListDialogElement&&(kundaliListDialogElement.dialog("close"),dpPageActionbar.takeActionOnKundaliSelect())},open:function(){$(this).removeClass("ui-autocomplete-loading"),$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-autocomplete-loading"),$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}).each(function(){$.data(this,"ui-autocomplete")._renderItem=function(ul,item){var innerHtml=item.listLabel;return $("<li></li>").data("item.autocomplete",item).append(innerHtml).appendTo(ul)}})}getKundaliSearchListData(item){let formattedDatetime,kundaliImage=(formattedDatetime=void 0===item.datetime_localized?this.getDisplayDatetimeFromMysqlTimestamp(item.datetime):item.datetime_localized,this.search_icon_),kundaliImageAlt=item.name;var kundaliTag=void 0!==item.kundali_tag?item.kundali_tag:"";return item.image&&0!==item.image.length&&(kundaliImage=item.image[0],kundaliImageAlt=item.image[1]),{listLabel:'<div class="list_item_container"><img class="list_item_image dpKundaliNameSearchIcon" src ="'+kundaliImage+'" alt="'+kundaliImageAlt+'"><strong>'+kundaliImageAlt+"</strong><br><small>"+formattedDatetime+"</small><br><small>"+item.city+", "+(item.state?item.state+", ":"")+item.country+"</small></div>",geoData:item.city+"|"+item.state+"|"+item.country+"|"+item.latitude+"|"+item.longitude+"|"+item.elevation+"|"+item.olson_timezone+"|"+item.timezone_offset,kundaliData:item.kundali_id+"|"+item.name+"|"+item.datetime+"|"+item.ayanamsha+"|"+item.gender+"|"+kundaliTag,value:item.name,imageData:[kundaliImage,kundaliImageAlt],kundaliTag:kundaliTag}}getDisplayDatetimeFromMysqlTimestamp(mysqlDateTime){let yearMultiplier=1;"-"===mysqlDateTime[0]&&(yearMultiplier=-1,mysqlDateTime=mysqlDateTime.substring(1));var mysqlDateTime=mysqlDateTime.split(" "),dateParts=mysqlDateTime[0].split("-"),mysqlDateTime=mysqlDateTime[1].split(":"),year=parseInt(dateParts[0],10)*yearMultiplier,monthUpdatedIntValue=parseInt(dateParts[1],10)-1,dateParts=parseInt(dateParts[2],10),hour=parseInt(mysqlDateTime[0],10),minute=parseInt(mysqlDateTime[1],10),mysqlDateTime=parseInt(mysqlDateTime[2],10),mysqlDateTime=new Date(year,monthUpdatedIntValue,dateParts,hour,minute,mysqlDateTime).getDay(),monthUpdatedIntValue=this.month_localization_list_[monthUpdatedIntValue],mysqlDateTime=this.weekday_localization_list_[mysqlDateTime],monthUpdatedIntValue=monthUpdatedIntValue+" "+dateParts.toString().replace(/[0123456789]/g,dpEssential.replaceNumerals.bind(dpEssential))+", "+year.toString().replace(/[0123456789]/g,dpEssential.replaceNumerals.bind(dpEssential))+", "+mysqlDateTime,dateParts=this.getFormatted12HourClockTime(hour,minute);return this.descriptive_datetime_format_.format(monthUpdatedIntValue,dateParts)}getFormatted12HourClockTime(hour,minute){var amOrPmSuffix=12<=hour?this.am_pm_localization_list_[1]:this.am_pm_localization_list_[0],hour=(hour=12<(hour=0===hour?12:hour)?hour-12:hour,DpDtTiUtils.getPaddedNumberString(hour)),minute=DpDtTiUtils.getPaddedNumberString(minute);return hour.replace(/[0123456789]/g,dpEssential.replaceNumerals.bind(dpEssential))+":"+minute.replace(/[0123456789]/g,dpEssential.replaceNumerals.bind(dpEssential))+" "+amOrPmSuffix}}