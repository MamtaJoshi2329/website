"use strict";var dpICSExportRange="month";class DpUserNotes{constructor(){}registerButtonClickListeners(){this.setICSDownloadClickListener(),this.setSignInDialogClickListener(),this.setGCalPanchangExportClickListener(),this.setAddNoteClickListener(),this.setUpdateNoteClickListener()}postAjaxDataPayload(postUrl,onSuccessCallback,payloadData,successMsg,errorMsg,reloadFlag){$.ajax({type:"POST",url:postUrl,data:JSON.stringify({dp_payload:payloadData}),contentType:"application/json; charset=utf-8",success:function(result){onSuccessCallback(result,payloadData,successMsg,errorMsg,reloadFlag)},error:function(){DpDialog.showAlertMessage(errorMsg,DpImg.kImgErrorIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},6e3)}})}handleGCalAJAXResponse(serverResponse,payloadData,successMsg,errorMsg,reloadFlag){(serverResponse=serverResponse.replace(/\s/g,""))?(DpDialog.showAlertMessage(errorMsg,DpImg.kImgErrorIcon),console.log(serverResponse)):(DpDialog.showAlertMessage(successMsg,DpImg.kImgCheckMarkIcon),reloadFlag?location.reload():setTimeout(function(){$(".dpPopup").slideUp(100)},5e3))}handleICSAJAXResponse(serverResponse,payloadData,successMsg,errorMsg,reloadFlag){var year=dpTimeContext.page_js_date_.getFullYear(),monthName=dpTimeContext.page_js_date_.toLocaleDateString("en-us",{month:"long"}),monthName="year"===dpICSExportRange?year:monthName+" "+year,year=document.createElement("a"),serverResponse=window.URL.createObjectURL(new Blob([serverResponse],{type:"application/ics"}));year.href=serverResponse,year.download="Drik Panchang - "+monthName+".ics",year.style.display="none",document.body.appendChild(year),year.click(),window.URL.revokeObjectURL(serverResponse),DpDialog.showAlertMessage(successMsg,DpImg.kImgCheckMarkIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},5e3)}processNoteString(noteText){return 0===(noteText=noteText.trim()).length?(alert(dpAddConfirm),null):encodeURIComponent(noteText)}setICSDownloadClickListener(){let self=this;$("#dpDownloadICSId").on("click",function(){dpSignIn.drik_ads_free_flag_?self.showICSDownloadConfirmationPopup():dpSignIn.authenticated_user_flag_?dpSubscription.showPremiumFeatureDialog(dpIcsPremiumFeatureMsg):dpSubscription.showPremiumFeatureSignInDialog(dpIcsSignInMsg)})}showICSDownloadConfirmationPopup(){let self=this,confirmBoxWrapper=$(".dpOverlay"),confirmBox=$('<div class="dpConfirmBox"></div>');var confirmBoxTitle=$('<div class="dpConfirmBoxTitle">'+dpIcsPopupTitle+"</div>"),confirmText=$('<div style="padding-bottom:20px;">'+dpIcsPopupMessage+"</div>"),buttonWrapper=$("<div/>"),radioDiv=$('<div style="padding:0 10px 20px;"><label for="dpICSMonthId"><input type="radio" id="dpICSMonthId" name="ics_file_scope" value="'+dpIcsMonthlyDownload+'" checked> '+dpIcsMonthlyDownload+'</label><label for="dpICSYearId"><input type="radio" id="dpICSYearId" name="ics_file_scope" value="'+dpIcsYearlyDownload+'"> '+dpIcsYearlyDownload+"</label></div>"),cancelButton=$('<button type="button" class="dpButton" role="button">'+dpButtonCancel+"</button>"),downloadButton=$('<button type="button" class="dpButton" role="button" autofocus>'+dpButtonDownload+"</button>");buttonWrapper.append(cancelButton),buttonWrapper.append(downloadButton),confirmBox.append(confirmBoxTitle),confirmBox.append(confirmText),confirmBox.append(radioDiv),confirmBox.append(buttonWrapper),confirmBoxWrapper.append(confirmBox),confirmBoxWrapper.fadeIn(300),confirmBox.on("click",function(e){e.stopPropagation()}),downloadButton.on("click",function(){let dateFrom=dpGoogleCalExportFrom,dateTo=dpGoogleCalExportTo;dpICSExportRange="month",document.getElementById("dpICSYearId").checked&&(currentYear=dpTimeContext.page_js_date_.getFullYear(),dpICSExportRange="year",dateFrom="01/01/"+currentYear,dateTo="31/12/"+currentYear);var currentYear={calendar_type:dpPgContext.calendar_type_,date_from:dateFrom,date_to:dateTo,export_range:dpICSExportRange};DpDialog.showAlertMessage(dpIcsDownloadMsg,DpImg.kImgSpinnerIcon),self.postAjaxDataPayload(dpIcsDownloadPostURL,self.handleICSAJAXResponse.bind(self),currentYear,dpIcsSuccessMsg,dpIcsErrorMsg,!1),confirmBox.remove(),confirmBoxWrapper.fadeOut(300)}),cancelButton.on("click",function(){confirmBox.remove(),confirmBoxWrapper.fadeOut(300)})}setSignInDialogClickListener(){$(".dpShowSigninPrompt").on("click",function(){DpDialog.showAlertMessage(dpSigninMsg,DpImg.kImgErrorIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},8e3)})}setGCalPanchangExportClickListener(){let self=this;$("#dpSendPanchangId").on("click",function(){let confirmBoxWrapper=$(".dpOverlay"),confirmBox=$('<div class="dpConfirmBox"></div>');var confirmText=$('<div style="padding-bottom:20px;">'+dpExportConfirm+"</div>"),buttonWrapper=$("<div/>"),cancelButton=$('<button type="button" class="dpButton" role="button">'+dpButtonCancel+"</button>"),sendButton=$('<button type="button" class="dpButton" role="button" autofocus>'+dpButtonSend+"</button>");buttonWrapper.append(cancelButton),buttonWrapper.append(sendButton),confirmBox.append(confirmText),confirmBox.append(buttonWrapper),confirmBoxWrapper.append(confirmBox),confirmBoxWrapper.fadeIn(300),confirmBox.on("click",function(e){e.stopPropagation()}),sendButton.on("click",function(){var cmdJSON={date_from:dpGoogleCalExportFrom,date_to:dpGoogleCalExportTo,calendar_type:dpPgContext.calendar_type_,command:"export"};DpDialog.showAlertMessage(dpExportPost,DpImg.kImgSpinnerIcon),self.postAjaxDataPayload(dpGoogleCalPostURL,self.handleGCalAJAXResponse.bind(self),cmdJSON,dpExportSuccess,dpExportFail,!1),confirmBox.remove(),confirmBoxWrapper.fadeOut(300)}),cancelButton.on("click",function(){confirmBox.remove(),confirmBoxWrapper.fadeOut(300)})})}setAddNoteClickListener(){let self=this,addNoteWrapper=$("#dpAddNoteWrapperId"),updateNoteWrapper=$("#dpUpdateNoteWrapperId");$("#dpAddEventId").on("click",function(){var addNoteBox=$("<div/>"),dpNoteDivTitle=(addNoteBox.addClass("dpAddNote dpPanel"),$('<h3 class="dpAddNoteTitle dpPanelTitle">'+dpTitleAdd+"</h3>")),dpNoteDivTitleClose=$('<span class="dpPanelClose" id="dpAddNoteCloseId"><img src="'+DpImg.kImgCloseIcon+'" alt="close icon"></span>'),textArea=$('<textarea placeholder="'+dpAddPlaceholder+'" id="note-text" class="dpTextArea" />'),buttonWrapper=$("<div/>"),cancelButton=(buttonWrapper.addClass("dpButtonWrapper"),$('<button type="button" class="dpButton" role="button">'+dpButtonCancel+"</button>")),addNoteButton=$('<button type="button" class="dpButton" role="button">'+dpButtonAdd+"</button>");dpNoteDivTitle.append(dpNoteDivTitleClose),addNoteBox.append(dpNoteDivTitle),addNoteBox.append(textArea),buttonWrapper.append(cancelButton),buttonWrapper.append(addNoteButton),addNoteBox.append(buttonWrapper),addNoteWrapper.html(addNoteBox),addNoteWrapper.slideToggle(300),updateNoteWrapper.slideUp(300),$("#dpFabItemIconId").toggleClass("dpExpandedFabIcon"),addNoteButton.on("click",function(){var noteDate,noteText=$("#note-text").val();null!==(noteText=self.processNoteString(noteText))&&(noteDate=DpDtTiUtils.getFocusedDDMMYYYYDate(),$("#dpFabItemIconId").removeClass("dpExpandedFabIcon"),addNoteWrapper.slideUp(300),noteText={summary:noteText,date:noteDate,command:"add"},DpDialog.showAlertMessage(dpAddPost,DpImg.kImgSpinnerIcon),self.postAjaxDataPayload(dpGoogleCalPostURL,self.handleGCalAJAXResponse.bind(self),noteText,dpAddSuccess,dpAddFail,!0))}),cancelButton.on("click",function(){addNoteWrapper.slideUp(300),$("#dpFabItemIconId").removeClass("dpExpandedFabIcon")}),$("#dpAddNoteCloseId").on("click",function(){addNoteWrapper.slideUp(300),$("#dpFabItemIconId").removeClass("dpExpandedFabIcon")})})}setUpdateNoteClickListener(){let self=this;$(".dpUpdateEvent").on("click",function(){var currentText=$(this).text();let dpId=$(this).attr("id"),dpCalTag=$(this).attr("data-caltag");var updateNoteBox=$("<div/>"),dpUpdateDivTitle=(updateNoteBox.addClass("dpUpdateNode dpPanel"),$('<h3 class="dpAddNoteTitle dpPanelTitle">'+dpTitleUpdate+"</h3>")),dpUpdateDivTitleClose=$('<span class="dpPanelClose" id="dpUpdateNoteCloseId"><img src="'+DpImg.kImgCloseIcon+'" alt="close icon"></span>');let textArea=$('<textarea placeholder="Update Note" id="note-text" class="dpTextArea" />');var buttonWrapper=$("<div/>"),cancelButton=(buttonWrapper.addClass("dpButtonWrapper"),$('<button type="button" class="dpButton" role="button">'+dpButtonCancel+"</button>")),deleteButton=$('<button type="button" class="dpButton" role="button">'+dpButtonDelete+"</button>"),updateButton=$('<button type="button" class="dpButton" role="button">'+dpButtonUpdate+"</button>");dpUpdateDivTitle.append(dpUpdateDivTitleClose),updateNoteBox.append(dpUpdateDivTitle),textArea.text(currentText),updateNoteBox.append(textArea),buttonWrapper.append(cancelButton),buttonWrapper.append(deleteButton),buttonWrapper.append(updateButton),updateNoteBox.append(buttonWrapper);let updateNoteWrapper=$("#dpUpdateNoteWrapperId");dpUpdateDivTitleClose=$("#dpAddNoteWrapperId");updateNoteWrapper.html(updateNoteBox),cancelButton.on("click",function(){updateNoteWrapper.slideUp(300)}),updateButton.on("click",function(){var noteText=textArea.val();null!==(noteText=self.processNoteString(noteText))&&(noteText={primary_cal:dpCalTag,summary:noteText,id:dpId,command:"update"},DpDialog.showAlertMessage(dpUpdatePost,DpImg.kImgSpinnerIcon),console.log(noteText),self.postAjaxDataPayload(dpGoogleCalPostURL,self.handleGCalAJAXResponse.bind(self),noteText,dpUpdateSuccess,dpUpdateFail,!0),updateNoteWrapper.slideUp(300))}),deleteButton.on("click",function(){var noteString={primary_cal:dpCalTag,id:dpId,command:"delete"};DpDialog.showAlertMessage(dpDeletePost,DpImg.kImgSpinnerIcon),self.postAjaxDataPayload(dpGoogleCalPostURL,self.handleGCalAJAXResponse.bind(self),noteString,dpDeleteSuccess,dpDeleteFail,!0),updateNoteWrapper.slideUp(300)}),$("#dpFabItemIconId").removeClass("dpExpandedFabIcon"),dpUpdateDivTitleClose.slideUp(300),updateNoteWrapper.slideDown(300),$("#dpUpdateNoteCloseId").on("click",function(){updateNoteWrapper.slideUp(300)})})}}let dpUserNotes=new DpUserNotes;