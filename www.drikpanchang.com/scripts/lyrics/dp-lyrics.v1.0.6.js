"use strict";class DpLyrics{constructor(){this.global_ajax_post_request_=null,this.ajax_post_url_=null,this.video_=null,this.video_ext_=null,this.video_wrapper_=null,this.youtube_player_=null,this.youtube_player_ext_=null,this.wait_getting_result_string_=null,this.failed_to_get_result_string_=null,this.lyrics_cache_=[],this.youtube_cache_=[],this.text_reader_=new DpTextReader}initializeLyricsHandlers(){this.video_=$("#dpYoutubeVideoId"),this.video_ext_=$("#dpYoutubeVideoIdExt"),this.video_wrapper_=$(".dpVideoWrapper");var resultElement=document.getElementById("dpLyricsBlockId");null!==resultElement&&this.createLyricsLocalCache(resultElement.innerHTML),0!==this.video_wrapper_.length&&this.creatYoutubeLocalCache(this.video_wrapper_[0].outerHTML),this.handleYoutubeVideoAction(),this.text_reader_.handleLyricsFontSizeOnButtonClick()}handleYoutubeVideoAction(){if(0!==this.video_wrapper_.length){var tag=document.createElement("script"),firstScriptTag=(tag.src="https://www.youtube.com/iframe_api",document.getElementsByTagName("script")[0]);firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);let self=this;window.onYouTubeIframeAPIReady=function(){self.youtube_player_=new YT.Player("dpYoutubeVideoId",{events:{onStateChange:function(e){self.modifyPlayerStatus(self.video_ext_,self.youtube_player_ext_),self.onPlayerStateChange(e,self.video_)}}}),self.youtube_player_ext_=new YT.Player("dpYoutubeVideoIdExt",{events:{onStateChange:function(e){self.modifyPlayerStatus(self.video_,self.youtube_player_),self.onPlayerStateChange(e,self.video_ext_)}}})},this.handleVideoVisibilityOnScroll(),this.takeActionOnVideoCloseButton()}}modifyPlayerStatus(videoElement,videoPlayer){0<videoElement.length&&(videoElement.hasClass("dpIsVideoPlaying")||videoElement.hasClass("dpIsVideoPaused"))&&(videoPlayer.pauseVideo(),videoElement.removeClass("dpIsVideoPlaying"),videoElement.removeClass("dpIsVideoPaused"))}onPlayerStateChange(event,videoElement){YT.PlayerState.PLAYING===event.data?(videoElement.addClass("dpIsVideoPlaying"),videoElement.removeClass("dpIsVideoPaused")):YT.PlayerState.PAUSED===event.data?(videoElement.addClass("dpIsVideoPaused"),videoElement.removeClass("dpIsVideoPlaying")):YT.PlayerState.ENDED===event.data&&(videoElement.removeClass("dpIsVideoPlaying"),videoElement.removeClass("dpIsVideoPaused"))}handleVideoVisibilityOnScroll(){let self=this,singleVideoHeight=this.video_.outerHeight();let videoBottom=(0<this.video_ext_.length?this.video_ext_.outerHeight()+singleVideoHeight:singleVideoHeight)+this.video_wrapper_.offset().top;window.addEventListener("scroll",function(){var windowScrollTop=$(window).scrollTop();self.video_.toggleClass("dpVideoFixed",windowScrollTop>videoBottom&&(self.video_.hasClass("dpIsVideoPlaying")||self.video_.hasClass("dpIsVideoPaused"))),self.video_ext_.toggleClass("dpVideoFixed",windowScrollTop>videoBottom&&(self.video_ext_.hasClass("dpIsVideoPlaying")||self.video_ext_.hasClass("dpIsVideoPaused"))),self.video_.hasClass("dpIsVideoPlaying")||self.video_.hasClass("dpIsVideoPaused")?self.video_ext_.removeClass("dpVideoFixed"):(self.video_ext_.hasClass("dpIsVideoPlaying")||self.video_ext_.hasClass("dpIsVideoPaused"))&&self.video_.removeClass("dpVideoFixed"),windowScrollTop>videoBottom?self.video_wrapper_.height(singleVideoHeight):(self.video_wrapper_.height("auto"),$(".dpVideo").removeAttr("style"),$(".dpVideoCloseButton").removeAttr("style"))})}takeActionOnVideoCloseButton(){$(".dpVideoCloseButton").on("click",function(){$(".dpVideo.dpVideoFixed").css({display:"none"}),$(".dpVideoCloseButton").css({display:"none"})})}handleLyricsChangeOnButtonClick(thisRef,lyricsContext){var lyricsLanguageKey=dpCookiesMngr.getCookie("drik-lyrics-language");if(void 0!==this.youtube_cache_[lyricsLanguageKey]&&(resultHTML=this.youtube_cache_[lyricsLanguageKey],this.populateYoutubeResultDivWithAJAXHTML(resultHTML)),void 0!==this.lyrics_cache_[lyricsLanguageKey]){let resultHTML=this.lyrics_cache_[lyricsLanguageKey];this.populateResultDivWithAJAXHTML(thisRef,"dpLyricsBlockId",resultHTML)}else{this.wait_getting_result_string_="Loading lyrics... Please wait!",this.failed_to_get_result_string_="Something went wrong!<br>Failed to change lyrics. Please try again or report at feedback@drikpanchang.com",this.ajax_post_url_="/ajax/lyrics/dp-lyrics.php";var resultHTML={page_url:location.pathname,lyrics_type:lyricsContext},lyricsLanguageKey=JSON.stringify({dp_payload:resultHTML});this.postAjaxDataPayload(thisRef,"dpLyricsBlockId",lyricsLanguageKey)}}postAjaxDataPayload(thisRef,resultElementId,payloadJSONData){let self=this;DpDialog.showAlertMessage(this.wait_getting_result_string_,DpImg.kImgSpinnerIcon),$(".dpPopup").slideUp(1e3),this.global_ajax_post_request_=$.ajax({type:"POST",cache:!1,url:self.ajax_post_url_,data:payloadJSONData,contentType:"application/json; charset=utf-8",beforeSend:function(){null!==self.global_ajax_post_request_&&self.global_ajax_post_request_.abort()},success:function(ajaxResultData){var ajaxResultData=JSON.parse(ajaxResultData),lyricsResultHTML=(setTimeout(function(){$(".dpPopup").slideUp(1e3)},5e3),ajaxResultData["lyrics-ui"]),ajaxResultData=ajaxResultData["youtube-ui"];self.createLyricsLocalCache(lyricsResultHTML),self.populateResultDivWithAJAXHTML(thisRef,resultElementId,lyricsResultHTML),""!==ajaxResultData&&(self.creatYoutubeLocalCache(ajaxResultData),self.populateYoutubeResultDivWithAJAXHTML(ajaxResultData)),self.global_ajax_post_request_=null},error:function(){DpDialog.showAlertMessage(self.failed_to_get_result_string_,DpImg.kImgErrorIcon),setTimeout(function(){$(".dpPopup").slideUp(1e3)},5e3),self.global_ajax_post_request_=null}})}populateResultDivWithAJAXHTML(thisRef,resultElementId,resultHTML){$(thisRef).parent().find(".dpSelectedButton").removeClass("dpSelectedButton"),$(thisRef).addClass("dpSelectedButton"),document.getElementById(resultElementId).innerHTML=resultHTML}populateYoutubeResultDivWithAJAXHTML(resultHTML){var placeholderDiv=document.createElement("div"),resultHTML=(placeholderDiv.innerHTML=resultHTML,$(".dpVideoWrapper").find("iframe")),placeholderDiv=placeholderDiv.getElementsByTagName("iframe");resultHTML[0].src!==placeholderDiv[0].src&&$(".dpVideoWrapper iframe").attr("src",placeholderDiv[0].src)}createLyricsLocalCache(elementLyricsHTML){var lyricsLanguageKey=dpCookiesMngr.getCookie("drik-lyrics-language");this.lyrics_cache_[lyricsLanguageKey]=elementLyricsHTML}creatYoutubeLocalCache(elementYoutubeHTML){var lyricsLanguageKey=dpCookiesMngr.getCookie("drik-lyrics-language");this.youtube_cache_[lyricsLanguageKey]=elementYoutubeHTML}}let dpLyrics=null;