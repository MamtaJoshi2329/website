"use strict";function prepareCitySearchAutocomplete(instantCitySearchID){$.ui.autocomplete.prototype._resizeMenu=function(){var ul=this.menu.element,autocompleteWidth=this.element.outerWidth()<300?300:this.element.outerWidth();ul.outerWidth(autocompleteWidth)};var xmlHttpRequest,geoLocalCache={};$("#dp-city-search, #dp-second-city-search, #dp-direct-city-search").autocomplete({source:function(request,response){var inputTerm=request.term;if((inputTerm=(inputTerm=inputTerm.trim().toLowerCase()).replace(/\s\s+/g," "))in geoLocalCache){$(this).removeClass("ui-autocomplete-loading");var cachedData=geoLocalCache[inputTerm];response($.map(cachedData.geonames,function(item){return getGeoSearchListData(item)}))}else{try{void 0!==xmlHttpRequest&&xmlHttpRequest.abort()}catch(e){}xmlHttpRequest=$.ajax({url:"/ajax/geo/dp-city-search.php",dataType:"json",data:{search:request.term,"prime-geo":dpPgContext.only_prime_location_},success:function(data){DpPgContext.tagSearchEventInGA4("city_search",request.term),$(this).removeClass("ui-autocomplete-loading"),geoLocalCache[inputTerm]=data,response($.map(data.geonames,function(item){return getGeoSearchListData(item)}))},error:function(){$(this).removeClass("ui-autocomplete-loading")}})}},minLength:2,autoFocus:!0,select:function(event,ui){instantCitySearchID!==document.activeElement.id?dpPageForm.fillFormWithSelectedItem(ui.item.geoData,document.activeElement.id):processSelection(ui.item.geoId)},open:function(){$(this).removeClass("ui-autocomplete-loading"),$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-autocomplete-loading"),$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}).each(function(){$.data(this,"ui-autocomplete")._renderItem=function(ul,item){var innerHtml='<div class="list_item_container"><img class="list_item_image" src="'+item.flagUrl+'" alt="Flag"/>'+item.listLabel+"</div>";return $("<li></li>").data("item.autocomplete",item).append(innerHtml).appendTo(ul)}})}function getGeoSearchListData(item){return{listLabel:"<strong>"+item.city+"</strong><br><small>"+(null!=item.state&&item.state.length?item.state+", ":"")+item.country+"</small>",geoData:item.city+"|"+item.state+"|"+item.country+"|"+item.latitude+"|"+item.longitude+"|"+item.elevation+"|"+item.olson_timezone+"|"+item.timezone_offset,flagUrl:item.flag_url,geoId:item.id,value:item.city}}function processSelection(geonameId){var focusedDatetime="",dateMonth=(null!=dpTimeContext.page_js_date_?(dateMonth=dpTimeContext.page_js_date_.getMonth()+1,dateDay=dpTimeContext.page_js_date_.getDate(),dateYear=dpTimeContext.page_js_date_.getFullYear(),dateMonth=DpDtTiUtils.getPaddedNumberString(dateMonth),focusedDatetime="&date="+(dateDay=DpDtTiUtils.getPaddedNumberString(dateDay))+"/"+dateMonth+"/"+(dateYear=DpDtTiUtils.getPaddedFormattedYear(dateYear)),(dateDay=getQueryStringValue("time"))&&(focusedDatetime+="&time="+dateDay)):null!=dpTimeContext.page_yyyy_year_&&(focusedDatetime="&year="+dpTimeContext.page_yyyy_year_),location.pathname),dateYear=(dateMonth=null!=dpPgContext.page_core_url_?dpPgContext.page_core_url_:dateMonth)+"?geoname-id="+geonameId,dateDay=document.getElementsByTagName("body")[0],dateMonth=document.getElementById("dpLocationWrapperId");0!==focusedDatetime.length&&"/"!==location.pathname&&(dateYear+=focusedDatetime),dateMonth&&(dateDay.style.opacity="0.7",dateMonth.classList.remove("dpShowBlock")),window.location.href=dateYear}function gotoCitySearchPage(event){13!==event.which||(event=$("#"+event.target.id).val().trim()).length<2||(location="/location/panchang-city-finder.html?dpcityfinder="+event)}function prepareTextInputForFocus(inputBoxID){let inputBoxValue="";$("#"+inputBoxID).on("click",function(){inputBoxID===document.activeElement.id&&(inputBoxValue=document.getElementById(inputBoxID).value,document.getElementById(inputBoxID).value="")}).on("blur",function(){0===$("#"+inputBoxID).val().length&&(document.getElementById(inputBoxID).value=inputBoxValue)})}function getQueryStringValue(key){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(key).replace(/[.+*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}document.addEventListener("DOMContentLoaded",function(){prepareTextInputForFocus("dp-direct-city-search"),prepareCitySearchAutocomplete("dp-direct-city-search")});