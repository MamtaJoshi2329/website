"use strict";let dpSubscription=null,kAdsFreeBannerHiddenExpiryKey="dp-ads-free-banner-hidden-expiry";class DpSubscription{constructor(){this.ajax_post_url_=null,this.ajax_post_request_=null,this.payload_data_=null,this.wait_getting_result_string_=null,this.failed_to_get_result_string_=null,this.email_id_empty_error_string_=null,this.email_id_not_valid_error_string_=null,this.country_empty_error_string_=null,this.postal_code_empty_error_string_=null,this.postal_code_not_valid_error_string_=null,this.signin_popup_title_string_=null,this.signin_popup_message_string_=null,this.pending_ads_free_icon_click_flag_=!1}initialize(){let self=this;$(document).on("change",".dpProductsSwitch input",function(){var itemDiscountedPrice=$(".dpItemDiscountedPrice"),itemActualPrice=$(".dpItemActualPrice"),itemMonthlyPriceHint=$(".dpItemMonthlyPriceHint"),itemYearlyPriceHint=$(".dpItemYearlyPriceHint"),itemMonthlyBilledInfo=$(".dpItemMonthlyBilledInfo"),itemAnnuallyBilledInfo=$(".dpItemAnnuallyBilledInfo");$(this).is(":checked")?(itemDiscountedPrice.show(),itemActualPrice.hide(),itemAnnuallyBilledInfo.show(),itemMonthlyPriceHint.hide(),itemYearlyPriceHint.show(),itemMonthlyBilledInfo.hide(),itemAnnuallyBilledInfo.show()):(itemDiscountedPrice.hide(),itemActualPrice.show(),itemAnnuallyBilledInfo.hide(),itemMonthlyPriceHint.show(),itemYearlyPriceHint.hide(),itemMonthlyBilledInfo.show(),itemAnnuallyBilledInfo.hide())}),$(document).on("click","#dp-selection-button",function(){var subscriptionType=$("#dp-product-toggle-switch").is(":checked")?"YEARLY":"MONTHLY";self.buildOrderSummaryPopUp(subscriptionType)}),$(document).on("click",".dpTransactionSuccessClose, .dpTransactionErrorClose",function(){$(".dpTransactionOverlay").hide()}),$(document).on("click",".dpTransactionErrorTryAgain",function(){$(".dpTransactionOverlay").hide(),self.handleAdsFreeIconClick()});var hiddenUntil,adsFreeBannerWrapper=document.getElementsByClassName("dpAdsFreeBannerWrapper");null!==adsFreeBannerWrapper&&0<adsFreeBannerWrapper.length&&((hiddenUntil=localStorage.getItem(kAdsFreeBannerHiddenExpiryKey))&&(new Date).getTime()<parseInt(hiddenUntil)?adsFreeBannerWrapper[0].style.display="none":adsFreeBannerWrapper[0].style.display="flex")}handleAdsFreeIconClick(){var signInTitle,signInMessage;dpSignIn.authenticated_user_flag_?"expired"===dpSignIn.drik_ads_free_status_?this.buildExpiredSubscriptionPopup():"active"===dpSignIn.drik_ads_free_status_?this.buildActiveSubscriptionPopup():this.buildSubscriptionProductList():(signInTitle=this.signin_popup_title_string_,signInMessage=this.signin_popup_message_string_,this.pending_ads_free_icon_click_flag_=!0,this.showSignInDialog(signInTitle,signInMessage))}showPremiumFeatureSignInDialog(signInMessage){this.pending_ads_free_icon_click_flag_=!0,this.showSignInDialog(null,signInMessage)}buildOrderSummaryPopUp(subscriptionType){DpDialog.showAlertMessage("<br>"+this.wait_getting_result_string_,DpImg.kImgSpinnerIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},2e3),this.payload_data_={subscription_type:subscriptionType,ui_command:"build_order_summary",transaction_page_url:location.pathname},this.postAjaxDataPayload()}buildSubscriptionProductList(){DpDialog.showAlertMessage("<br>"+this.wait_getting_result_string_,DpImg.kImgSpinnerIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},2e3),this.payload_data_={ui_command:"list_subscription_products"},this.postAjaxDataPayload()}buildActiveSubscriptionPopup(){DpDialog.showAlertMessage("<br>"+this.wait_getting_result_string_,DpImg.kImgSpinnerIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},2e3),this.payload_data_={ui_command:"active_subscription"},this.postAjaxDataPayload()}buildExpiredSubscriptionPopup(){DpDialog.showAlertMessage("<br>"+this.wait_getting_result_string_,DpImg.kImgSpinnerIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},2e3),this.payload_data_={ui_command:"expired_subscription"},this.postAjaxDataPayload()}buildSubscriptionHistoryPopup(){DpDialog.showAlertMessage("<br>"+this.wait_getting_result_string_,DpImg.kImgSpinnerIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},2e3),this.payload_data_={ui_command:"subscription_history"},this.postAjaxDataPayload()}closePlanDetailsPopup(){$(".dpActivePlanDetailsOverlay").remove(),this.enableBackgroundScroll()}closeSubscriptionHistoryPopup(){$(".dpOrderHistoryOverlay").remove(),$(".dpActivePlanDetailsOverlay").css({display:"flex"})}postAjaxDataPayload(){let self=this;this.ajax_post_request_=$.ajax({type:"POST",url:self.ajax_post_url_,data:JSON.stringify({dp_payload:self.payload_data_}),contentType:"application/json; charset=utf-8",beforeSend:function(){null!==self.ajax_post_request_&&self.ajax_post_request_.abort()},success:function(result){var overlay,uiCommand=self.payload_data_.ui_command;"list_subscription_products"===uiCommand?(self.clearOverlays(),(overlay=document.createElement("div")).className="dpProductsListOverlay",overlay.innerHTML=result,document.body.appendChild(overlay),self.setProductListCloseClickListener()):"build_order_summary"===uiCommand?($(".dpOrderSummaryOverlay").remove(),$(".dpActivePlanDetailsOverlay").hide(),$(".dpProductsListOverlay").hide(),$("body").append(result),self.setOrderSummaryCloseClickListener(),self.setOrderSummarySubmitClickListener()):"active_subscription"===uiCommand||"expired_subscription"===uiCommand?$("body").append(result):"subscription_history"===uiCommand&&($(".dpActivePlanDetailsOverlay").hide(),$("body").append(result)),self.disableBackgroundScroll(),self.ajax_post_request_=null,setTimeout(function(){$(".dpPopup").slideUp(100)},200)},error:function(response){DpDialog.showAlertMessage(this.failed_to_get_result_string_,DpImg.kImgErrorIcon),setTimeout(function(){$(".dpPopup").slideUp(100)},5e3),self.ajax_post_request_=null}})}clearOverlays(){$(".dpProductsListOverlay").remove(),$(".dpOrderSummaryOverlay").remove(),$(".dpActivePlanDetailsOverlay").remove(),$(".dpPremiumFeatureOverlay").remove()}setOrderSummarySubmitClickListener(){let self=this;$(document).on("click","#dp-order-submit",function(event){!1===self.validateOrderSummaryDetails()["error-flag"]&&document.getElementById("dp-order-form").submit()})}validateOrderSummaryDetails(){var validationMap=[],userEmail=(validationMap["error-flag"]=!1,$("#dp-billing-email").val()),userCountry=$("#dp-billing-country").val(),userPostalCode=$("#dp-billing-postal-code").val();return validationMap["error-flag"]=DpFormUtils.validateEmailID(userEmail,this.email_id_empty_error_string_,this.email_id_not_valid_error_string_),validationMap["error-flag"]||(userEmail=userCountry.trim().length,""===userCountry||0===userEmail?(alert(this.country_empty_error_string_),validationMap["error-flag"]=!0):(userCountry=userPostalCode.trim().length,""===userPostalCode||0===userCountry?(alert(this.postal_code_empty_error_string_),validationMap["error-flag"]=!0):!1===/^[a-z0-9][a-z0-9\- ]{0,10}[a-z0-9]$/.test(userPostalCode)&&(alert(this.postal_code_not_valid_error_string_),validationMap["error-flag"]=!0))),validationMap}hideAdsFreeBanner(event){var hideUntil=(new Date).getTime()+864e5;localStorage.setItem(kAdsFreeBannerHiddenExpiryKey,hideUntil.toString()),$(".dpAdsFreeBannerWrapper").hide()}checkPendingAdsFreeIconClick(){this.pending_ads_free_icon_click_flag_&&($(".dpSignInOverlay").remove(),this.buildSubscriptionProductList(),this.pending_ads_free_icon_click_flag_=!1)}showPremiumFeatureDialog(signInMessage){let self=this;var overlay=$("<div>",{class:"dpPremiumFeatureOverlay"}),dialogBox=$("<div>",{class:"dpPremiumFeaturePopup"}),signInMessage=$("<div>",{class:"dpPremiumFeaturePopupContent",html:signInMessage}),actions=$("<div>",{class:"dpPremiumFeaturePopupActions"}),subscribeNowButton=$("<div>",{class:"dpSubscribeNowButton",html:"Subscribe Now"}),closeButton=$("<button>",{class:"dpPremiumFeaturePopupClose",html:"&#x0058;"});actions.append(subscribeNowButton,closeButton),dialogBox.append(signInMessage,actions),overlay.append(dialogBox),$("body").append(overlay),$(".dpPremiumFeaturePopupClose").on("click",function(){$(".dpPremiumFeatureOverlay").remove()}),$(".dpSubscribeNowButton").on("click",function(){self.buildSubscriptionProductList()})}showSignInDialog(signInTitle,signInMessage){var overlay=$("<div>",{class:"dpSignInOverlay"}),dialogBox=$("<div>",{class:"dpSignInPopup"}),signInTitle=$("<div>",{class:"dpSignInPopupTitle",html:signInTitle}),signInMessage=$("<div>",{class:"dpSignInPopupContent",html:signInMessage}),actions=$("<div>",{class:"dpSignInPopupActions"}),signInButtonWrapper=$("<button>",{class:"dpSignInPopupButtonWrapper"}),signInMediumButton=$("<div>",{class:"dpSignInMediumButton"}),closeButton=$("<button>",{class:"dpSignInPopupClose",html:"&#x0058;"});signInButtonWrapper.append(signInMediumButton),actions.append(signInButtonWrapper,closeButton),dialogBox.append(signInTitle,signInMessage,actions),overlay.append(dialogBox),$("body").append(overlay),$(".dpSignInPopupClose").on("click",function(){$(".dpSignInOverlay").remove()}),window.google&&google.accounts?.id&&google.accounts.id.renderButton(signInMediumButton[0],{type:"standard",shape:"rectangular",theme:"outline",size:"medium",text:"signin",logo_alignment:"left",width:"66"})}setOrderSummaryCloseClickListener(){let self=this;$(".dpOrderSummaryCloseButton").on("click",function(){$(document).off("click","#dp-order-submit");var productListOverlay=$(".dpProductsListOverlay");0===productListOverlay.length?self.enableBackgroundScroll():productListOverlay.show(),$(".dpOrderSummaryOverlay").remove(),$(".dpActivePlanDetailsOverlay").css({display:"flex"})})}setProductListCloseClickListener(){let self=this;$(".dpProductListCloseButton").on("click",function(){var activePlanDetailsOverlay=$(".dpActivePlanDetailsOverlay");0===activePlanDetailsOverlay.length?self.enableBackgroundScroll():activePlanDetailsOverlay.show(),$(".dpProductsListOverlay").remove()})}disableBackgroundScroll(){$("html").css({overflow:"hidden"})}enableBackgroundScroll(){$("html").css({"overflow-y":"scroll"})}}