"use strict";class DpKundaliForm extends DpGeoForm{constructor(){super(),this.kundali_=new DpKundali,this.kundali_ext_=new DpKundali,this.kundali_.setGeo=this.geo_,this.kundali_ext_.setGeo=this.geo_ext_,this.result_area_default_HTML_=$("#dp-result-content").html(),this.handler_=null,this.layout_builder_=null,this.twin_form_context_=!1,this.form_submit_context_flag_=!1,this.kundali_search_=new DpKundaliSearch,this.date_type_handler_=new DpDateTypeHandler,this.kundali_local_storage_=new DpKundaliLocalStorage,"function"==typeof DpKundaliListPopup&&(this.kundali_list_popup_=new DpKundaliListPopup)}registerButtonClickListeners(){this.handler_=new DpKundaliHandler,this.kundali_search_.prepareForKundaliSearch();let self=this;var kundaliGenderWidget=$(".dpKundaliGenderItem");this.kundali_.setGender=$(".dpKundaliGenderItem.dpSelectedOption").attr("data-gender"),kundaliGenderWidget.on("click",function(){self.kundali_.setGender=$(this).attr("data-gender");var elementMap=document.getElementsByClassName("dpKundaliGenderItem");self.updateButtonsCSSStyle(elementMap,"dpSelectedOption"),this.classList.remove("dpSelectedOption"),$(this).addClass("dpSelectedOption")}),DpKundaliContext.kKundali!==this.kundali_.getContext&&(this.fillDateAndTimeFields(),this.setPoppedUpFormFieldsChangeListener()),this.clear_button_.addEventListener("click",function(){self.clearKundaliForm()},!1),this.submit_button_.addEventListener("click",function(){self.form_submit_context_flag_=!0,dpPageForm.kundali_.setDBContext=0<dpPageForm.kundali_.getID?DpDBKundaliContext.kEdit:DpDBKundaliContext.kSave,self.handler_.showDataConfirmationDialog()},!1),this.handleActionOnFormFocusedField(),this.handleFormFieldsClickListeners(),this.performActionOnLatitudeLongitudeValueChange(),this.notifyForLostContextOnMovingAway(),this.buildLayoutController(),this.handleOverlayOnClick(),this.date_type_handler_.registerButtonClickListeners()}buildLayoutController(){var dpScreenScope;"function"==typeof DpKundaliLayoutBuilder&&(this.layout_builder_=new DpKundaliLayoutBuilder,dpScreenScope=0===(dpScreenScope=dpCookiesMngr.getCookie("drik-screen-scope")).length?"full":dpScreenScope,this.layout_builder_.yugma_kundali_ui_status_flag_="full"===dpScreenScope,this.layout_builder_.yugma_kundali_ui_status_flag_)&&this.layout_builder_.buildYugmaKundaliUIContext()}handleOverlayOnClick(){let self=this;$(document).on("click","#dp-page-overlay",function(){var formElement;DpKundaliContext.kUndefined!==self.kundali_.getContext&&(DpKundaliContext.kKundali===self.kundali_.getContext&&dpPageActionbar.enableKundaliActionbarButtons(),0!==(formElement=$(".dpForm")).length&&formElement.hasClass("dpPopupForm")&&($(".dpPopupForm").removeClass("dpPopupForm dpEditForm").hide(),DpKundaliContext.kKundali!==self.kundali_.getContext&&DpKundaliContext.kMuhurta!==self.kundali_.getContext||$("#dp-clear-button").off()),$(this).hide().css("zIndex",2))})}notifyForLostContextOnMovingAway(){DpKundaliContext.kKundali===this.kundali_.getContext&&window.addEventListener("beforeunload",function(e){$(".ui-dialog").is(":visible")&&(e.preventDefault(),e.returnValue="")})}handleFormFieldsClickListeners(){let self=this;$(".dpExtendedFieldsToggle").on("click",function(){$(".dpExtendedFields").slideToggle(200),$(".dpExtendedGeoFields").slideDown(200);var expandButtonImg=$(".dpExtendedFieldsToggle > img");self.toggleExtendedFieldToggleButtonIcon(expandButtonImg)}),$(".dpExtendedFieldsToggle-second").on("click",function(){$(".dpExtendedFields-second").slideToggle(200),$(".dpExtendedGeoFields-second").slideDown(200);var expandButtonImg=$(".dpExtendedFieldsToggle-second > img");self.toggleExtendedFieldToggleButtonIcon(expandButtonImg)}),$("#dp-name, #dp-second-name").on("click",function(){var placeHolder="dp-second-name"===document.activeElement.id?"-second":"",expandButtonImg=$(".dpFormCollapseButton"+placeHolder+" img");$(".dpFormCollapse"+placeHolder).slideDown(),expandButtonImg.attr("src",dpCompressIconURL),expandButtonImg.attr("data-alt-src",dpExpandIconURL)}),$(".dpFormCollapseButton").on("click",function(){$(".dpFormCollapse").slideToggle();var collapseButtonImg=$(".dpFormCollapseButton img");self.toggleExtendedFieldToggleButtonIcon(collapseButtonImg)}),$(".dpFormCollapseButton-second").on("click",function(){$(".dpFormCollapse-second").slideToggle();var collapseButtonImg=$(".dpFormCollapseButton-second img");self.toggleExtendedFieldToggleButtonIcon(collapseButtonImg)})}clearKundaliForm(){var context=this.kundali_.getContext;this.kundali_.setDBContext=DpKundaliContext.kKundali===context||DpKundaliContext.kMuhurta===context?DpDBKundaliContext.kNew:DpDBKundaliContext.kUndefined,$("#dp-offset").html(dpEssential.numeral_map_[0]),DpKundaliContext.kKundali!==context&&DpKundaliContext.kMuhurta!==context&&$("#dp-result-content").html(this.result_area_default_HTML_),document.querySelector(".dpForm").reset(),this.resetKundaliGenderButtonFocus(),this.date_type_handler_.resetFormDateType()}setPoppedUpFormFieldsChangeListener(){$(".dpForm :input").on("change",function(){"dp-name"!==this.id&&$(".dpForm").data("changed",!0)})}removeOpenDialogInstance(){$(".ui-dialog").remove(),$(".dpBhavaBalaButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpShadaBalaButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpVimshottariButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpPlanetaryPositionButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpKundaliReadingButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpKundaliDrikReadingButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpKundaliPanchangButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpKundaliYogaButton").prop("disabled",!1).removeClass("dpDisabledButton"),$(".dpAshtakaVargaButton").prop("disabled",!1).removeClass("dpDisabledButton")}openKundaliPageWithPostedData(url,data){var form=document.createElement("form"),url=(document.body.appendChild(form),form.method="post",form.action=url,document.createElement("input"));url.type="hidden",url.name=data,form.appendChild(url),form.submit()}updateButtonsCSSStyle(elementMap,cssStyleName){for(let elementIndex=0;elementIndex<elementMap.length;elementIndex++)elementMap[elementIndex].classList.remove(cssStyleName)}showFormOnKundaliOptionClick(){$("#dp-page-overlay").show().css({"z-index":5}),$(".dpForm").addClass("dpPopupForm").show(),$(".dpFormFieldsCollapse").show(),this.handleActionOnFormFocusedField()}populatePoppedUpFormFields(){this.date_type_handler_.resetFormDateType(),$("#dp-name").val(this.kundali_.getName),$("#dp-ayanamsha").val(this.kundali_.getAyanamsha);var geo=this.kundali_.getGeo,geo=geo.getCity+"|"+geo.getState+"|"+geo.getCountry+"|"+geo.getLatitude+"|"+geo.getLongitude+"|"+geo.getElevation+"|"+geo.getOlsonTimezone+"|"+geo.getTimezoneOffset;this.fillFormWithSelectedItem(geo,"dp-city-search"),this.fillDateAndTimeFields(),this.updateKundaliGenderButtonFocus()}handleFormCloseButtonClick(){this.kundali_.setDBContext=DpDBKundaliContext.kUndefined,$(".dpForm").off("keydown"),$(".dpPopupForm").removeClass("dpPopupForm dpEditForm").hide(),DpKundaliContext.kKundali!==this.kundali_.getContext&&DpKundaliContext.kMuhurta!==this.kundali_.getContext||$("#dp-clear-button").off(),$("#dp-page-overlay").hide().css({"z-index":2}),this.resetKundaliGenderButtonFocus(),DpKundaliContext.kKundali===this.kundali_.getContext?dpPageActionbar.enableKundaliActionbarButtons():DpKundaliContext.kMuhurta===this.kundali_.getContext&&dpPageActionbar.handleExitAfterKundaliSelection()}prepareAndGetKundaliDataFromPayload(payloadLookup){var mysqlFormatDateTime=payloadLookup.kundali_date.split("/").reverse().join("-")+" "+payloadLookup.kundali_time,updatedKundaliData={};return updatedKundaliData.kundali_id=parseInt(payloadLookup.kundali_id,10),updatedKundaliData.name=payloadLookup.kundali_name,updatedKundaliData.gender=payloadLookup.kundali_gender,updatedKundaliData.city=payloadLookup.kundali_city,updatedKundaliData.state=payloadLookup.kundali_state,updatedKundaliData.country=payloadLookup.kundali_country,updatedKundaliData.datetime=mysqlFormatDateTime,updatedKundaliData.date_type=payloadLookup.kundali_date_type,updatedKundaliData.latitude=payloadLookup.kundali_latitude,updatedKundaliData.longitude=payloadLookup.kundali_longitude,updatedKundaliData.olson_timezone=payloadLookup.kundali_olson_timezone,updatedKundaliData.timezone_offset=payloadLookup.kundali_timezone_offset,updatedKundaliData.elevation=payloadLookup.kundali_elevation,updatedKundaliData.ayanamsha=payloadLookup.kundali_ayanamsha,updatedKundaliData.kundali_tag=payloadLookup.kundali_tag,updatedKundaliData}populateKundaliWithFormData(){var payloadData;DpKundaliContext.kMuhurta===this.kundali_.getContext&&(payloadData=dpKundaliPost.getAjaxRequestDataPayload(),DpActiveKundali.kSecondary===dpPageActionbar.active_kundali_?(dpPageActionbar.kundali_pair_available_flag_=!0,dpPageActionbar.kundali_aux_.setPayload=payloadData):dpPageActionbar.kundali_.setPayload=payloadData)}toggleExtendedFieldToggleButtonIcon(expandButtonImg){var imageSource=expandButtonImg.attr("src"),imageAltSource=expandButtonImg.data("alt-src");expandButtonImg.attr("src",imageAltSource),expandButtonImg.data("alt-src",imageSource)}validateKundaliForm(){if(DpKundaliContext.kKundali!==this.kundali_.getContext||!1!==this.form_submit_context_flag_){var placeHolder=this.secondary_context_?"-second":"",kundali=this.secondary_context_?this.kundali_ext_:this.kundali_,kundaliNameId="dp"+placeHolder+"-name";if(document.getElementById(kundaliNameId)){if((kundaliNameId=this.validateNameWithCharRestriction(kundaliNameId))["error-flag"])return!0;kundali.setName=kundaliNameId["kundali-name"]}if((kundaliNameId=this.validateDateFields())["error-flag"])return!0;var day=kundaliNameId["datetime-day"],month=kundaliNameId["datetime-month"],kundaliNameId=kundaliNameId["datetime-year"];if(kundali.setDate=day+"/"+month+"/"+kundaliNameId,(day=this.validate12HourClockTime())["error-flag"])return!0;var month=day["datetime-hour"],kundaliNameId=day["datetime-minute"],day=day["datetime-second"];if(kundali.setTime=month+":"+kundaliNameId+":"+day,(month=this.validateCustomGeoStrings())["error-flag"])return $(".dpExtendedGeoFields").slideDown(200),!0;if(kundali.getGeo.setCity=month["geo-city"],kundali.getGeo.setState=month["geo-state"],kundali.getGeo.setCountry=month["geo-country"],(month=this.validateCustomGeoData())["error-flag"])return $(".dpExtendedFields").slideDown(200),kundaliNameId=$(".dpExtendedFieldsToggle > img"),this.toggleExtendedFieldToggleButtonIcon(kundaliNameId),!0;kundali.getGeo.setLatitude=month["geo-latitude"],kundali.getGeo.setLongitude=month["geo-longitude"],kundali.getGeo.setElevation=month["geo-elevation"],kundali.getGeo.setOlsonTimezone=month["geo-olson-timezone"],kundali.getGeo.setTimezoneOffset=month["geo-timezone-offset"];day="dp"+placeHolder+"-ayanamsha";if(document.getElementById(day)){if((kundaliNameId=this.validateAyanamsha(day))["error-flag"])return!0;kundali.setAyanamsha=kundaliNameId["kundali-ayanamsha"]}}return!1}fillDateAndTimeFields(){let populateFormKundaliFlag=!1,currentDay,currentMonth,currentYear,currentHour,currentMinute,currentSecond;null!==this.kundali_.getDate&&null!==this.kundali_.getTime?(splitDate=this.kundali_.getDate.split("/"),splitTime=this.kundali_.getTime.split(":"),currentDay=parseInt(splitDate[0],10),currentMonth=parseInt(splitDate[1],10),currentYear=parseInt(splitDate[2],10),currentHour=parseInt(splitTime[0],10),currentMinute=parseInt(splitTime[1],10),currentSecond=parseInt(splitTime[2],10)):(splitDate=new Date,currentDay=splitDate.getDate(),currentMonth=splitDate.getMonth()+1,currentYear=splitDate.getFullYear(),currentHour=splitDate.getHours(),currentMinute=splitDate.getMinutes(),currentSecond=splitDate.getSeconds(),populateFormKundaliFlag=!0);var localizedYear,splitTime=this.kundali_.getContext,splitDate=(DpKundaliContext.kKundali!==splitTime&&DpKundaliContext.kKundaliList!==splitTime||currentYear<0&&(this.date_type_handler_.updateDateEpochSignOnYearFieldPopulateOrChange(currentYear.toString()),currentYear*=-1),12<=currentHour?"1":"0"),splitTime=(currentHour=0===(currentHour=12<=currentHour?currentHour-12:currentHour)?12:currentHour,DpDtTiUtils.getPaddedNumberString(currentDay)),localMonth=DpDtTiUtils.getPaddedNumberString(currentMonth),localYear=DpDtTiUtils.getPaddedFormattedYear(currentYear),localHour=DpDtTiUtils.getPaddedNumberString(currentHour),localMinute=DpDtTiUtils.getPaddedNumberString(currentMinute),localSecond=DpDtTiUtils.getPaddedNumberString(currentSecond),yearElement=$("#dp-year");0===$("#dp-year option[value='"+localYear+"']").length&&(localizedYear=localYear.toString().replace(/[0123456789]/g,dpEssential.replaceNumerals.bind(dpEssential)),yearElement.append(new Option(localizedYear,localYear))),$("#dp-day").val(splitTime),$("#dp-month").val(localMonth),yearElement.val(localYear),$("#dp-hour").val(localHour),$("#dp-minute").val(localMinute),$("#dp-second").val(localSecond),$("#dp-am-pm").val(splitDate),this.twin_form_context_&&($("#dp-second-day").val(splitTime),$("#dp-second-month").val(localMonth),$("#dp-second-year").val(localYear),$("#dp-second-hour").val(localHour),$("#dp-second-minute").val(localMinute),$("#dp-second-second").val(localSecond),$("#dp-second-am-pm").val(splitDate)),!0===populateFormKundaliFlag&&(this.kundali_.setDate=splitTime+"/"+localMonth+"/"+localYear,this.kundali_.setTime=localHour+":"+localMinute+":"+localSecond,this.kundali_ext_.setDate=this.kundali_.getDate,this.kundali_ext_.setTime=this.kundali_.getTime)}fillFormWithSelectedKundaliItem(kundaliData,selectorID){this.kundali_.setDBContext=DpDBKundaliContext.kUndefined;var kundaliData=kundaliData.split("|"),kundaliId=parseInt(kundaliData[0],10),kundaliName=kundaliData[1];let birthDatetime=kundaliData[2],yearPrefix="";"-"===birthDatetime[0]&&(yearPrefix="-",birthDatetime=birthDatetime.substring(1));var ayanamsha=kundaliData[3],gender=kundaliData[4],kundaliData=kundaliData[5],splitDateTime=birthDatetime.split(" "),kundaliSplitDate=splitDateTime[0].split("-"),splitDateTime=splitDateTime[1].split(":"),birthYear=yearPrefix+kundaliSplitDate[0],birthMonth=kundaliSplitDate[1],kundaliSplitDate=kundaliSplitDate[2],birthHour=splitDateTime[0],birthMinutes=splitDateTime[1],splitDateTime=splitDateTime[2];let amPmValue=0,displayBirthYear=birthYear;var kundaliContext=this.kundali_.getContext,kundaliContext=(DpKundaliContext.kKundali!==kundaliContext&&DpKundaliContext.kKundaliList!==kundaliContext||"-"===birthYear[0]&&(displayBirthYear=birthYear.substring(1),this.date_type_handler_.updateDateEpochSignOnYearFieldPopulateOrChange(birthYear)),parseInt(birthHour,10));let birthHourIntval=kundaliContext;0===birthHourIntval?birthHourIntval=12:12<birthHourIntval?(birthHourIntval-=12,amPmValue=1):12===birthHourIntval&&(amPmValue=1);var localizedYear,birthHour=DpDtTiUtils.getPaddedNumberString(birthHourIntval),yearElement="dp-second-name"===selectorID?$("#dp-second-year"):$("#dp-year");0===yearElement.find("option[value='"+displayBirthYear+"']").length&&(localizedYear=displayBirthYear.toString().replace(/[0123456789]/g,dpEssential.replaceNumerals.bind(dpEssential)),yearElement.append(new Option(localizedYear,displayBirthYear))),("dp-second-name"===selectorID?(this.kundali_ext_.setID=kundaliId,this.kundali_ext_.setName=kundaliName,this.kundali_ext_.setGender=gender,this.kundali_ext_.setAyanamsha=ayanamsha,this.kundali_ext_.setKundaliTag=kundaliData,this.kundali_ext_.setDate=kundaliSplitDate+"/"+birthMonth+"/"+birthYear,this.kundali_ext_.setTime=DpDtTiUtils.getPaddedNumberString(kundaliContext)+":"+birthMinutes+":"+splitDateTime,$("#dp-second-name").val(kundaliName),$("#dp-second-ayanamsha").val(ayanamsha),$("#dp-second-day").val(kundaliSplitDate),$("#dp-second-month").val(birthMonth),yearElement.val(displayBirthYear),$("#dp-second-hour").val(birthHour),$("#dp-second-minute").val(birthMinutes),$("#dp-second-second").val(splitDateTime),$("#dp-second-am-pm")):(this.kundali_.setID=kundaliId,this.kundali_.setName=kundaliName,this.kundali_.setGender=gender,this.kundali_.setAyanamsha=ayanamsha,this.kundali_.setKundaliTag=kundaliData,this.kundali_.setDate=kundaliSplitDate+"/"+birthMonth+"/"+birthYear,this.kundali_.setTime=DpDtTiUtils.getPaddedNumberString(kundaliContext)+":"+birthMinutes+":"+splitDateTime,$("#dp-name").val(kundaliName),$("#dp-ayanamsha").val(ayanamsha),$("#dp-day").val(kundaliSplitDate),$("#dp-month").val(birthMonth),yearElement.val(displayBirthYear),$("#dp-hour").val(birthHour),$("#dp-minute").val(birthMinutes),$("#dp-second").val(splitDateTime),$("#dp-am-pm"))).val(amPmValue),this.updateKundaliGenderButtonFocus()}updateKundaliGenderButtonFocus(){let self=this;$(".dpKundaliGenderItem").each(function(){var genderDataAttr=$(this).attr("data-gender");this.classList.remove("dpSelectedOption"),self.kundali_.getGender===genderDataAttr&&$(this).addClass("dpSelectedOption")})}resetKundaliGenderButtonFocus(){$(".dpKundaliGenderItem").each(function(){var genderDataAttr=$(this).attr("data-gender");this.classList.remove("dpSelectedOption"),"M"===genderDataAttr&&$(this).addClass("dpSelectedOption")})}handleActionOnFormFocusedField(){var kundaliForm=$(".dpForm");if(kundaliForm.is(":visible")){$("#dp-name").trigger("focus");let self=this;kundaliForm.on("keydown",function(event){let code,tabCompare=9,enterCompare=13;void 0!==event.key?(code=event.key,tabCompare="Tab",enterCompare="Enter"):void 0!==event.keyIdentifier?code=event.keyIdentifier:void 0!==event.keyCode&&(code=event.keyCode);var activeElement=$(document.activeElement),activeElement=(enterCompare===code&&self.enableClickListenerOnSelectiveFormElements(activeElement),$(activeElement).attr("id"));tabCompare===code&&"dp-submit-button"===activeElement&&(event.preventDefault(),$("#dp-name").trigger("focus"))})}}enableClickListenerOnSelectiveFormElements(activeElement){($(activeElement).hasClass("dpGenderMale")||$(activeElement).hasClass("dpGenderFemale")||$(activeElement).hasClass("dpFieldToggleButton"))&&activeElement.trigger("click")}validateNameWithCharRestriction(nameFieldId){var validatedNameValueMap=[],nameFieldId=(validatedNameValueMap["error-flag"]=!1,document.getElementById(nameFieldId)),nameFieldId=nameFieldId?nameFieldId.value:"";return""===nameFieldId.trim()?(alert(this.secondary_context_?dpSecondEmptyUserNameString:dpEmptyUserNameString),validatedNameValueMap["error-flag"]=!0):/^[0-9A-Z a-z\u0400-\u1C8F'.,-]{2,1024}$/.test(nameFieldId.trim())?validatedNameValueMap["kundali-name"]=nameFieldId:(alert(this.secondary_context_?dpSecondUserNameTooLongString:dpUserNameTooLongString),validatedNameValueMap["error-flag"]=!0),validatedNameValueMap}validateDateFields(){var validatedDateValueMap=[],placeHolder=this.secondary_context_?"-second":"",selectedMonth=document.getElementById("dp"+placeHolder+"-month").value,selectedDay=document.getElementById("dp"+placeHolder+"-day").value,placeHolder=document.getElementById("dp"+placeHolder+"-year").value,selectedMonthInt=parseInt(selectedMonth,10),selectedDayInt=parseInt(selectedDay,10),selectedYearInt=parseInt(placeHolder,10);return 0===selectedMonth.length||isNaN(selectedMonthInt)||selectedMonthInt<1||12<selectedMonthInt?(alert(this.secondary_context_?dpSecondEmptyDateMonthString:dpEmptyDateMonthString),validatedDateValueMap["error-flag"]=!0):0===selectedDay.length||isNaN(selectedDayInt)||selectedDayInt<1||31<selectedDayInt?(alert(this.secondary_context_?dpSecondEmptyDateDayString:dpEmptyDateDayString),validatedDateValueMap["error-flag"]=!0):0===placeHolder.length||isNaN(selectedYearInt)||selectedYearInt<-9999||9999<selectedYearInt?(alert(this.secondary_context_?dpSecondEmptyDateYearString:dpEmptyDateYearString),validatedDateValueMap["error-flag"]=!0):DpDtTiUtils.totalDaysInAMonth(selectedMonth,placeHolder)<selectedDayInt?(alert(this.secondary_context_?dpSecondMonthDayMismatchString:dpMonthDayMismatchString),validatedDateValueMap["error-flag"]=!0):(validatedDateValueMap["error-flag"]=!1,validatedDateValueMap["datetime-day"]=DpDtTiUtils.getPaddedNumberString(selectedDayInt),validatedDateValueMap["datetime-month"]=DpDtTiUtils.getPaddedNumberString(selectedMonthInt),placeHolder=this.date_type_handler_.updateYearBasedOnChosenEpochSign(placeHolder),placeHolder=DpDtTiUtils.getPaddedFormattedYear(placeHolder),validatedDateValueMap["datetime-year"]=placeHolder),validatedDateValueMap}validate24HourClockTime(){return this.validateHourMinuteAndSeconds(23)}validate12HourClockTime(){var placeHolder=this.secondary_context_?"-second":"",placeHolder=document.getElementById("dp"+placeHolder+"-am-pm").value,selectedAmPmInt=parseInt(placeHolder,10),validatedTimeValueMap=this.validateHourMinuteAndSeconds(12);if(!validatedTimeValueMap["error-flag"]){if(0===placeHolder.length||"0"!==placeHolder&&"1"!==placeHolder)return alert(this.secondary_context_?dpSecondEmptyTimeAmPmString:dpEmptyTimeAmPmString),validatedTimeValueMap["error-flag"]=!0,validatedTimeValueMap;let selectedHourInt=parseInt(validatedTimeValueMap["datetime-hour"],10);0===selectedAmPmInt&&12===selectedHourInt?(selectedHourInt-=12,validatedTimeValueMap["datetime-hour"]=DpDtTiUtils.getPaddedNumberString(selectedHourInt)):1===selectedAmPmInt&&12!==selectedHourInt&&(selectedHourInt+=12,validatedTimeValueMap["datetime-hour"]=DpDtTiUtils.getPaddedNumberString(selectedHourInt))}return validatedTimeValueMap}validateHourMinuteAndSeconds(maxHourValue){var validatedTimeValueMap=[],placeHolder=this.secondary_context_?"-second":"",selectedHour=document.getElementById("dp"+placeHolder+"-hour").value,selectedMinute=document.getElementById("dp"+placeHolder+"-minute").value,placeHolder=document.getElementById("dp"+placeHolder+"-second").value,selectedHourInt=parseInt(selectedHour,10),selectedMinuteInt=parseInt(selectedMinute,10),selectedSecondInt=parseInt(placeHolder,10);return 0===selectedHour.length||isNaN(selectedHourInt)||selectedHourInt<0||maxHourValue<selectedHourInt?(alert(this.secondary_context_?dpSecondEmptyTimeHoursString:dpEmptyTimeHoursString),validatedTimeValueMap["error-flag"]=!0):0===selectedMinute.length||isNaN(selectedMinuteInt)||selectedMinuteInt<0||59<selectedMinuteInt?(alert(this.secondary_context_?dpSecondEmptyTimeMinutesString:dpEmptyTimeMinutesString),validatedTimeValueMap["error-flag"]=!0):0===placeHolder.length||isNaN(selectedSecondInt)||selectedSecondInt<0||59<selectedSecondInt?(alert(this.secondary_context_?dpSecondEmptyTimeSecondsString:dpEmptyTimeSecondsString),validatedTimeValueMap["error-flag"]=!0):(validatedTimeValueMap["error-flag"]=!1,validatedTimeValueMap["datetime-hour"]=DpDtTiUtils.getPaddedNumberString(selectedHourInt),validatedTimeValueMap["datetime-minute"]=DpDtTiUtils.getPaddedNumberString(selectedMinuteInt),validatedTimeValueMap["datetime-second"]=DpDtTiUtils.getPaddedNumberString(selectedSecondInt)),validatedTimeValueMap}validateAyanamsha(ayanamshaFieldId){var validatedAyanamshaValueMap=[],ayanamshaFieldId=(validatedAyanamshaValueMap["error-flag"]=!1,document.getElementById(ayanamshaFieldId)),ayanamshaFieldId=ayanamshaFieldId.value;return void 0===ayanamshaFieldId||0===ayanamshaFieldId.length?(alert(this.secondary_context_?dpSecondEmptyAyanamshaString:dpEmptyAyanamshaString),validatedAyanamshaValueMap["error-flag"]=!0):validatedAyanamshaValueMap["kundali-ayanamsha"]=ayanamshaFieldId,validatedAyanamshaValueMap}}class DpDateTypeHandler{registerButtonClickListeners(){var kundaliContext=dpPageForm.kundali_.getContext;DpKundaliContext.kKundali!==kundaliContext&&DpKundaliContext.kKundaliList!==kundaliContext||(this.handleClickOnKundaliDateTypeWidget(),this.handleClickOnKundaliDateEpochSignWidget())}resetFormDateType(){var kundaliContext=dpPageForm.kundali_.getContext;DpKundaliContext.kKundali!==kundaliContext&&DpKundaliContext.kKundaliList!==kundaliContext||($(".dpDateTypeRadioButtonInput").removeAttr("checked"),$('.dpDateTypeRadioButtonInput[data-date-type="gregorian"]').prop("checked",!0),dpPageForm.kundali_.setDateType="gregorian",this.populateGregorianEpochSignOptions())}handleClickOnKundaliDateTypeWidget(){let self=this;dpPageForm.kundali_.setDateType=$(".dpDateTypeRadioButtonInput input[type=radio]:checked").attr("data-date-type"),$(".dpForm .dpDateTypeRadioButtonInput").on("click",function(){$(this).find("input[type=radio]").removeAttr("checked"),$(this).attr("checked","checked"),$(this).prop("checked",!0);var dateType=$(this).attr("data-date-type");dpPageForm.kundali_.setDateType=dateType;let updateFormEpochField=!0;"julian"===dateType?(dateType=self.getSwitchToJulianDateConfirmationMessageHTML(),dpPageForm.handler_.showConfirmationBox(dateType,function(){DpDialogHandler.removeActionConfirmationBoxAndOverlay(),self.populateJulianEpochSignOptions(updateFormEpochField)},function(){DpDialogHandler.removeActionConfirmationBoxAndOverlay(),$(".dpDateTypeRadioButtonInput").removeAttr("checked"),$('.dpDateTypeRadioButtonInput[data-date-type="gregorian"]').prop("checked",!0),self.populateGregorianEpochSignOptions(updateFormEpochField)})):self.populateGregorianEpochSignOptions(updateFormEpochField)})}handleClickOnKundaliDateEpochSignWidget(){$(".dpForm .dpDateEpochSignSelector").on("change",function(){$(".dpDateEpochSignSelector option").removeAttr("selected"),$(this).find("option:selected").attr("selected","selected"),$(this).find("option:selected").prop("selected",!0)})}updateYearBasedOnChosenEpochSign(dropdownYear){let updatedYear=dropdownYear;var kundaliContext=dpPageForm.kundali_.getContext;return DpKundaliContext.kKundali!==kundaliContext&&DpKundaliContext.kKundaliList!==kundaliContext||(kundaliContext=$(".dpDateEpochSignSelector").find("option:selected").val(),updatedYear="negative-epoch"===kundaliContext?"-"+dropdownYear:dropdownYear),updatedYear}getSwitchToJulianDateConfirmationMessageHTML(){return'<div class="dpLeftAlignText">'+dpDateTypeSelectionMessage+"</div><br>"}populateJulianEpochSignOptions(updateFormEpochField){var epochLabelBC=dpJulianDateEpochSignLabel[0],epochValueAD=dpJulianDateEpochSignLabel[1];this.buildDateEpochSignSelectOptions(epochLabelBC,epochValueAD,updateFormEpochField)}populateGregorianEpochSignOptions(updateFormEpochField){var epochLabelNegativeYear="- "+dpGregorianDateEpochSignLabel[1],epochValuePositiveYear="+ "+dpGregorianDateEpochSignLabel[1];this.buildDateEpochSignSelectOptions(epochLabelNegativeYear,epochValuePositiveYear,updateFormEpochField)}buildDateEpochSignSelectOptions(epochLabelNegative,epochLabelPositive,updateFormEpochField){updateFormEpochField=updateFormEpochField?$(".dpForm .dpDateEpochSignSelector"):$(".dpDateEpochSignSelector"),updateFormEpochField.find("option").remove().end(),updateFormEpochField.append(new Option(epochLabelPositive,"positive-epoch")),updateFormEpochField.append(new Option(epochLabelNegative,"negative-epoch")),epochLabelPositive=updateFormEpochField.find('option[value="positive-epoch"]');epochLabelPositive.attr("selected","selected"),epochLabelPositive.prop("selected",!0)}updateDateEpochSignOnYearFieldPopulateOrChange(selectedYear){selectedYear="-"===selectedYear[0]?"negative-epoch":"positive-epoch",$(".dpDateEpochSignSelector option").removeAttr("selected"),selectedYear=$(".dpDateEpochSignSelector option[value='"+selectedYear+"']");selectedYear.attr("selected","selected"),selectedYear.prop("selected",!0)}}class DpTwinKundaliForm extends DpKundaliForm{registerButtonClickListeners(){this.handler_=new DpTwinKundaliHandler,this.kundali_search_.prepareForKundaliSearch(),this.result_area_default_HTML_=$("#dp-result-content").html(),this.twin_form_context_=!0,this.fillDateAndTimeFields();let self=this;this.clear_button_.addEventListener("click",function(){self.clearKundaliForm()},!1),this.submit_button_.addEventListener("click",function(){self.handler_.showDataConfirmationDialog()},!1),this.handleActionOnFormFocusedField(),this.handleFormFieldsClickListeners(),this.performActionOnLatitudeLongitudeValueChange(),dpPageForm.secondary_context_=!0,this.performActionOnLatitudeLongitudeValueChange(),dpPageForm.secondary_context_=!1}clearKundaliForm(){$("#dp-offset").val(dpEssential.numeral_map_[0]),$("#dp-second-offset").val(dpEssential.numeral_map_[0]),$("#dp-result-content").html(this.result_area_default_HTML_);var formElements=document.getElementsByClassName("dpForm");for(let formIndex=0;formIndex<formElements.length;formIndex++)formElements[formIndex].reset();document.querySelector(".dpFormTitle").scrollIntoView({behavior:"smooth",block:"start"})}}